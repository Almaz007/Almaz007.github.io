import{r as y,j as e,c as S}from"./index-YnzaWmgs.js";import{u as N}from"./store-C_-nwUWL.js";import{d as z}from"./helpers-fab74NUc.js";import{c as F,s as D}from"./shallow-D7CosS3X.js";import{B as C}from"./Button-CDNgYNpJ.js";import{u as k}from"./store-C0MudxkG.js";import{u as T}from"./store-DkPUckZ1.js";const A="_wrapper_zxo5y_1",B="_form_zxo5y_17",E="_drag_zxo5y_29",O="_label_zxo5y_43",$="_input_zxo5y_49",U="_info_zxo5y_93",W="_btns_zxo5y_103",u={wrapper:A,form:B,drag:E,"action-title":"_action-title_zxo5y_35",label:O,input:$,"file-list":"_file-list_zxo5y_63","download-label":"_download-label_zxo5y_73",info:U,btns:W,"button-reset":"_button-reset_zxo5y_111","button-submit":"_button-submit_zxo5y_113","dnd-tile":"_dnd-tile_zxo5y_135"},v=({handleSubmit:r,title:f})=>{const[o,s]=y.useState([]),[i,a]=y.useState(!1),c=t=>{t.preventDefault(),t.target.files&&t.target.files[0]&&s([t.target.files[0]])},g=()=>{s([])},p=function(t){t.preventDefault(),a(!0)},d=function(t){t.preventDefault(),a(!1)},h=function(t){var m;t.preventDefault(),a(!1),(m=t.dataTransfer)!=null&&m.files&&t.dataTransfer.files[0]&&s([t.dataTransfer.files[0]])};return e.jsxs("div",{className:S(u.wrapper,{[u.drag]:i}),children:[e.jsx("h2",{className:u["dnd-tile"],children:f}),e.jsxs("form",{className:S(u.form),onReset:g,onDragEnter:p,onDragOver:p,onDragLeave:d,onDrop:h,children:[e.jsx("h2",{className:u["action-title"],children:"Перетащите файлы сюда"}),e.jsx("p",{children:"или"}),e.jsxs("label",{className:u.label,children:[e.jsx("span",{className:u["download-label"],children:"Загрузите файл"}),e.jsx("input",{className:u.input,type:"file",multiple:!1,onChange:c})]}),o.length>0&&e.jsxs("div",{className:u.info,children:[e.jsx("ul",{className:u["file-list"],children:e.jsx("li",{children:o[0].name})}),e.jsxs("div",{className:u.btns,children:[e.jsx("button",{className:u["button-reset"],type:"reset",children:"Отменить"}),e.jsx("button",{className:u["button-submit"],onClick:t=>r(t,o),children:"Отправить"})]})]})]})]})},L=F((r,f)=>({ws:null,status:"disconnected",error:null,messages:[],strForDownload:[],parseOscilografFile:async o=>{const{strForDownload:s}=f(),i=await o.arrayBuffer(),a=new DataView(i),c={};for(let d=0;d+16<=a.byteLength;d+=16){const h=a.getUint32(d,!0);if(h===0)return;const t=a.getUint32(d+4,!0),m=a.getUint32(d+8,!0),n=a.getUint32(d+12,!0),l=`номер: ${h}, метка: ${t}, смещение: ${m}, значение: ${n}`;s.push(l),c[m]||(c[m]={timePoints:[],values:[]}),c[m].timePoints.push(t),c[m].values.push(n)}s.push(`endPart

`),r({strForDownload:s});const g=N.getState();console.log(a);const p=a.byteLength!==1344;if(p){const t=`dataLogicAnalyzer_${new Date().toISOString().replace("T","_").replace(/:/g,"-").split(".")[0]}.txt`;z(s.join(`
`),t,"text/plain"),r({strForDownload:[]})}g.updateOscillographicData(c,p)},connect:o=>{let{ws:s,parseOscilografFile:i,status:a}=f();s||(r({status:"connecting",error:null}),s=new WebSocket(o),r({ws:s}),s.onopen=()=>{r({error:null,status:"connected"}),console.log("WebSocket connected")},s.onmessage=async c=>{c.data instanceof Blob?(r(g=>({messages:[...g.messages,`Получен бинарный пакет ${g.messages.length+1}`]})),await i(c.data)):(console.log("Получено с сервера:",c.data),r(g=>({messages:[...g.messages,c.data.toString()]})))},s.onerror=()=>{r({error:"Connection error",status:"disconnected"})},s.onclose=()=>{console.log("WebSocket closed. Status was:",a),s=null,r({ws:null,status:"disconnected"})})},disconnect:()=>{const{ws:o}=f();o&&(o.close(),r({ws:null,status:"disconnected"}))},sendMessage:o=>{const{ws:s}=f();s&&(r(i=>({messages:[...i.messages,o]})),s.send(o))},sendFile:o=>{const{ws:s}=f();s&&(r(i=>({messages:[...i.messages,"Файл отправлен"]})),s.send(o))},sendConfig:o=>{const{ws:s}=f();s&&(r(i=>({messages:[...i.messages,"Конфиг отправлен"]})),s.send(o))}})),P="_row_1156t_1",b={row:P,"action-btn":"_action-btn_1156t_11"},G=()=>{const r=T(n=>n.sendFirmware),f=N(n=>n.clearTempOscillographic),[o,s,i,a,c,g,p]=L(n=>[n.status,n.error,n.messages,n.connect,n.disconnect,n.sendConfig,n.sendFile],D),d=k(n=>n.config,D),h=()=>{const n=new TextEncoder().encode(JSON.stringify(d));if(n.length===0){console.log("конфиг не отправлен");return}const l=new TextEncoder().encode("flexibleLogic,"),x=new Uint8Array(l.length+n.length);x.set(l,0),x.set(n,l.length),g(x)},t=async(n,l)=>{if(n.preventDefault(),!l||l.length===0)return;const x=await l[0].arrayBuffer(),j=new Uint8Array(x),w=new TextEncoder().encode("firmware,"),_=new Uint8Array(w.length+j.length);_.set(w,0),_.set(j,w.length),p(_)},m=async(n,l)=>{if(n.preventDefault(),!l||l.length===0)return;const x=await l[0].arrayBuffer();r(x)};return e.jsxs("div",{children:[e.jsx("h2",{children:"WebSocket"}),e.jsxs("p",{children:["Status: ",o," ",s&&`| Error: ${s}`]}),e.jsx("br",{}),e.jsx("button",{className:b["action-btn"],onClick:()=>a("wss://int-rt.ru:3010"),children:"Подключить"}),e.jsx("br",{}),e.jsx("button",{className:b["action-btn"],onClick:c,children:"Отключить"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("button",{className:b["action-btn"],onClick:f,children:"Очистить временную память"}),e.jsx("div",{style:{height:"300px",overflowY:"auto",border:"1px solid blue",padding:"10px",marginTop:"10px"},children:i.map((n,l)=>e.jsx("p",{children:n},l))}),e.jsx("br",{}),e.jsxs("div",{className:b.row,children:[e.jsx(v,{handleSubmit:t,title:"Отправка прошивки по web-socket"}),e.jsx(v,{handleSubmit:m,title:"Отправка прошивки по ble"}),e.jsxs("div",{children:[e.jsx(C,{disabled:!d.scripts.length,onClick:h,text:"загрузить"}),e.jsx("br",{}),!d.scripts.length&&e.jsx("div",{children:"необходимо сформировать гибкую логику"})]})]})]})};export{G as default};
