import{R as f,j as o}from"./index-BW0KzlOM.js";import{u as x}from"./store-Drhix_Oi.js";import{a as h}from"./traditional-qqL8sDk3.js";const j=e=>e;function w(e,s=j){const t=f.useSyncExternalStore(e.subscribe,()=>s(e.getState()),()=>s(e.getInitialState()));return f.useDebugValue(t),t}const p=e=>{const s=h(e),t=a=>w(s,a);return Object.assign(t,s),t},y=e=>e?p(e):p,k=y((e,s)=>{let t=null,a="disconnected";const r=c=>{a=c,e({status:c})},m=async c=>{const i=await c.arrayBuffer(),n=new DataView(i),u={};for(let l=0;l+16<=n.byteLength;l+=16){if(n.getUint32(l,!0)===0)return;const b=n.getUint32(l+4,!0),g=n.getUint32(l+8,!0),S=n.getUint32(l+12,!0);u[g]||(u[g]={timePoints:[],values:[]}),u[g].timePoints.push(b),u[g].values.push(S)}x.getState().updateOscillographicData(u)},d=c=>{t||(r("connecting"),e({error:null}),t=new WebSocket(c),t.onopen=()=>{r("connected"),e({error:null}),console.log("WebSocket connected")},t.onmessage=async i=>{i.data instanceof Blob?(e(n=>({messages:[...n.messages,"Получен бинарный пакет"]})),await m(i.data)):(console.log("Получено с сервера:",i.data),e(n=>({messages:[...n.messages,i.data.toString()]})))},t.onerror=()=>{e({error:"Connection error"}),r("disconnected")},t.onclose=()=>{console.log("WebSocket closed. Status was:",a),r("disconnected"),t=null,setTimeout(()=>d(c),3e3)})};return{status:"disconnected",error:null,messages:[],connect:d,disconnect:()=>{t&&(t.close(),t=null,r("disconnected"))}}}),v=()=>{const{status:e,error:s,messages:t,connect:a,disconnect:r}=k();return o.jsxs("div",{children:[o.jsx("h2",{children:"WebSocket"}),o.jsxs("p",{children:["Status: ",e," ",s&&`| Error: ${s}`]}),o.jsx("button",{onClick:()=>a("wss://int-rt.ru:8081"),children:"Подключить"}),o.jsx("br",{}),o.jsx("button",{onClick:r,children:"Отключить"}),o.jsx("div",{style:{height:"300px",overflowY:"auto",border:"1px solid blue",padding:"10px",marginTop:"10px"},children:t.map((m,d)=>o.jsx("p",{children:m},d))})]})};export{v as default};
