import{r as g,j as e,c as h}from"./index-CLpBfaTk.js";import{u as x}from"./store-D7s1bfYj.js";import{c as j,s as w}from"./shallow-CQcGTQWp.js";import{B as v}from"./Button-K34HBVbK.js";import{I as S}from"./Input-B-WQDttw.js";const y="_wrapper_1r16a_1",D="_form_1r16a_17",k="_drag_1r16a_29",N="_label_1r16a_43",C="_input_1r16a_49",F="_info_1r16a_93",W="_btns_1r16a_103",i={wrapper:y,form:D,drag:k,"action-title":"_action-title_1r16a_35",label:N,input:C,"file-list":"_file-list_1r16a_63","download-label":"_download-label_1r16a_73",info:F,btns:W,"button-reset":"_button-reset_1r16a_111","button-submit":"_button-submit_1r16a_113"},b=j((o,l)=>({ws:null,status:"disconnected",error:null,messages:[],parseOscilografFile:async n=>{const s=await n.arrayBuffer(),t=new DataView(s),r={};for(let c=0;c+16<=t.byteLength;c+=16){if(t.getUint32(c,!0)===0)return;const p=t.getUint32(c+4,!0),d=t.getUint32(c+8,!0),a=t.getUint32(c+12,!0);r[d]||(r[d]={timePoints:[],values:[]}),r[d].timePoints.push(p),r[d].values.push(a)}x.getState().updateOscillographicData(r)},connect:n=>{let{ws:s,parseOscilografFile:t,status:r}=l();s||(o({status:"connecting",error:null}),s=new WebSocket(n),o({ws:s}),s.onopen=()=>{o({error:null,status:"connected"}),console.log("WebSocket connected")},s.onmessage=async u=>{u.data instanceof Blob?(o(c=>({messages:[...c.messages,"Получен бинарный пакет"]})),await t(u.data)):(console.log("Получено с сервера:",u.data),o(c=>({messages:[...c.messages,u.data.toString()]})))},s.onerror=()=>{o({error:"Connection error",status:"disconnected"})},s.onclose=()=>{console.log("WebSocket closed. Status was:",r),s=null,o({ws:null})})},disconnect:()=>{const{ws:n}=l();n&&(n.close(),o({ws:null,status:"disconnected"}))},sendMessage:n=>{const{ws:s}=l();s&&(o(t=>({messages:[...t.messages,n]})),s.send(n))},sendFile:n=>{const{ws:s}=l();s&&(o(t=>({messages:[...t.messages,"файл отправлен"]})),s.send(n))}})),B={"controll-block":"_controll-block_2ueij_1"},A=({})=>{const{sendMessage:o}=b(t=>({sendMessage:t.sendMessage})),[l,n]=g.useState(""),s=()=>{o(l),n("")};return e.jsxs("div",{className:B["controll-block"],children:[e.jsx(S,{value:l,onChange:t=>n(t.target.value)}),e.jsx(v,{text:"отправить",onClick:s})]})},E=()=>{const o=b(a=>a.sendFile),[l,n]=g.useState([]),[s,t]=g.useState(!1),r=a=>{a.preventDefault(),a.target.files&&a.target.files[0]&&n([a.target.files[0]])},u=()=>{n([])},c=async a=>{if(a.preventDefault(),!l||l.length===0)return;const f=await l[0].arrayBuffer(),_=new Uint8Array(f);o(_)},m=function(a){a.preventDefault(),t(!0)},p=function(a){a.preventDefault(),t(!1)},d=function(a){var f;a.preventDefault(),t(!1),(f=a.dataTransfer)!=null&&f.files&&a.dataTransfer.files[0]&&n([a.dataTransfer.files[0]])};return e.jsx("div",{className:h(i.wrapper,{[i.drag]:s}),children:e.jsxs("form",{className:h(i.form),onReset:u,onSubmit:c,onDragEnter:m,onDragOver:m,onDragLeave:p,onDrop:d,children:[e.jsx("h2",{className:i["action-title"],children:"Перетащите файлы сюда"}),e.jsx("p",{children:"или"}),e.jsxs("label",{className:i.label,children:[e.jsx("span",{className:i["download-label"],children:"Загрузите файл"}),e.jsx("input",{className:i.input,type:"file",multiple:!1,onChange:r})]}),l.length>0&&e.jsxs("div",{className:i.info,children:[e.jsx("ul",{className:i["file-list"],children:e.jsx("li",{children:l[0].name})}),e.jsxs("div",{className:i.btns,children:[e.jsx("button",{className:i["button-reset"],type:"reset",children:"Отменить"}),e.jsx("button",{className:i["button-submit"],type:"submit",children:"Отправить"})]})]})]})})},R=()=>{const[o,l,n,s,t]=b(r=>[r.status,r.error,r.messages,r.connect,r.disconnect],w);return e.jsxs("div",{children:[e.jsx("h2",{children:"WebSocket"}),e.jsxs("p",{children:["Status: ",o," ",l&&`| Error: ${l}`]}),e.jsx("button",{onClick:()=>s("wss://int-rt.ru:8081"),children:"Подключить"}),e.jsx("br",{}),e.jsx("button",{onClick:t,children:"Отключить"}),e.jsx("div",{style:{height:"300px",overflowY:"auto",border:"1px solid blue",padding:"10px",marginTop:"10px"},children:n.map((r,u)=>e.jsx("p",{children:r},u))}),e.jsx(A,{}),e.jsx("br",{}),e.jsx(E,{})]})};export{R as default};
