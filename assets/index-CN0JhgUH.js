import{u as v,b as M,r as m,j as e,q as F,m as E,d as U}from"./index-DSBvIpo4.js";import{B as f}from"./Button-BQUXm3FT.js";import{I as D}from"./Input-CspveY7l.js";import{T as k}from"./Table-wvy0Oaxe.js";import{M as B}from"./Modal-VH7ctpCD.js";import{s as _}from"./shallow-BHpKla55.js";import{C as H}from"./CheckBox-BXdUnhSx.js";const L=({id:c,value:u})=>{const{nodes:p,updateNodes:h}=v(r=>({nodes:r.nodes,updateNodes:r.updateNodes}),_),{nodes2:x,updateNodes2:j}=M(r=>({nodes2:r.nodes,updateNodes2:r.updateNodes}),_),l=m.useMemo(()=>p.find(r=>r.id===c),[p]),o=m.useMemo(()=>x.find(r=>r.id===c),[x]);if(!l&&!o)return e.jsx("div",{children:"узел не найден"});const s=l?r=>{const i={...l,data:{...l==null?void 0:l.data,name:r}},y=p.map(C=>C.id===i.id?i:C);h(y)}:o?r=>{const i={...o,data:{...o==null?void 0:o.data,name:r}},y=x.map(C=>C.id===i.id?i:C);j(y)}:()=>{};return e.jsx(D,{value:u,onChange:r=>s(r.target.value)})},O=({characteristic:c,field:u})=>{const[p,h]=F(s=>[s.setCharacteristicTypeData,s.characteristicTypeData]),[x,j]=m.useState(String(h[c][u])),l=s=>{if(/^-?\d*\.?\d*$/.test(s))if(j(s),v.getState().setDirty(),M.getState().setDirty(),s===""||s==="-"||s==="."||s==="-.")p(c,u,0);else{const i=parseFloat(s);isNaN(i)||p(c,u,i)}},o=()=>{const s=h[c][u];j(String(s))};return e.jsx(D,{value:x,onChange:s=>l(s.target.value),onBlur:o,type:"text"})},A={I:0,U:0,HRM3:0},K={characteristic:"U",k:0,offset:0},T=["id","name"],$=()=>{const{datas:c,setDatas:u,characteristicTypeData:p}=F(t=>({datas:t.datas,setDatas:t.setDatas,characteristicTypeData:t.characteristicTypeData,setCharacteristicTypeData:t.setCharacteristicTypeData}),_);console.log(p);const[h,x]=v(t=>[t.nodes,t.setDirty],_),[j,l]=M(t=>[t.nodes,t.setDirty],_);m.useEffect(()=>{const n=[...h,...j].filter(a=>{var N,g,w,V,R;return((g=(N=a==null?void 0:a.data)==null?void 0:N.type)==null?void 0:g.toLowerCase().includes("input"))&&((w=a==null?void 0:a.data)==null?void 0:w.type)!=="discreteInputConnect"&&((V=a==null?void 0:a.data)==null?void 0:V.type)!=="analogInputConnect"&&((R=a==null?void 0:a.data)==null?void 0:R.type)!=="analogInputIntConnect"}).reduce((a,N)=>(a[N.id]={...c[N.id]??A,id:N.id,name:N.data.name??""},a),{});u(n)},[h,j]);const o=m.useMemo(()=>Object.values(c),[c]),s=m.useMemo(()=>E({id:"",name:"",...A}),[]),r=m.useMemo(()=>E({...K}),[]),i=()=>s.map(t=>e.jsx("th",{children:t},t)),y=()=>r.map(t=>e.jsx("th",{children:t},t)),C=(t,n)=>{x(),l();const a=c[t];Object.entries(a).some(([g,w])=>g!==n&&!T.includes(g)&&w===1)&&a[n]===0||u({...c,[t]:{...a,[n]:a[n]?0:1}})},I=(t,n)=>{T.includes(n)||C(t,n)};return{renderHead:i,renderRow:t=>e.jsx(e.Fragment,{children:s.map(n=>{const a=!T.includes(n);return e.jsx("td",{style:{cursor:a?"pointer":"default"},children:n==="name"?e.jsx(L,{value:t.name,id:t.id}):a?e.jsx(H,{checked:!!t[n],onChange:()=>I(t.id,n)}):t[n]},n)})}),rows:o,characteristicTypeData:p,renderRowCharacteristic:t=>r.map(n=>e.jsx("td",{children:n==="characteristic"?t[n]:e.jsx(O,{characteristic:t.characteristic,field:n})},n)),renderHeadCharacteristics:y}},b={"table-row":"_table-row_7ap7j_1","btns-row":"_btns-row_7ap7j_11","modal-content":"_modal-content_7ap7j_23","modal-title":"_modal-title_7ap7j_31","controlled-block":"_controlled-block_7ap7j_39","input-row":"_input-row_7ap7j_51","input-label":"_input-label_7ap7j_61"},W=()=>{const{renderHead:c,renderRow:u,rows:p,characteristicTypeData:h,renderRowCharacteristic:x,renderHeadCharacteristics:j}=$(),[l,o]=m.useState(!1),[s,r]=m.useState(""),[i,y]=m.useState(""),[C]=U(d=>[d.send],_),I=()=>{!s.trim()||!i.trim()||(C(`ble_calib ${s} ${i}`),o(!1),r(""),y(""))},S=s.trim()!==""&&i.trim()!=="";return e.jsxs("div",{children:[e.jsxs("div",{className:b["table-row"],children:[e.jsx(k,{style:{minWidth:"450px"},renderRow:u,renderHead:c,rowItems:p,getRowKey:d=>d.id,maxWidth:1100}),e.jsx(k,{renderRow:x,renderHead:j,rowItems:Object.entries(h).map(([d,t])=>({characteristic:d,k:t.k})),getRowKey:d=>d.characteristic})]}),e.jsx("div",{className:b["btns-row"],children:e.jsx(f,{text:"Калибровка",onClick:()=>o(!0)})}),e.jsx(B,{visible:l,setVisible:o,children:e.jsxs("div",{className:b["modal-content"],children:[e.jsx("h2",{className:b["modal-title"],children:"Калибровка"}),e.jsxs("div",{className:b["controlled-block"],children:[e.jsxs("div",{className:b["input-row"],children:[e.jsx("label",{className:b["input-label"],children:"Напряжение (U):"}),e.jsx(D,{type:"number",value:s,onChange:d=>r(d.target.value),placeholder:"Введите значение U"})]}),e.jsxs("div",{className:b["input-row"],children:[e.jsx("label",{className:b["input-label"],children:"Ток (I):"}),e.jsx(D,{type:"number",value:i,onChange:d=>y(d.target.value),placeholder:"Введите значение I"})]}),e.jsx(f,{text:"Отправить",onClick:I,disabled:!S})]})]})})]})},Y=({})=>e.jsx("div",{children:e.jsx(W,{})});export{Y as default};
