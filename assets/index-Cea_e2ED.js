import{r as R,j as a}from"./index-5v0WUSE6.js";import{u as F,a as H,g as L,R as B,i as q,B as K,C as X}from"./store2-B2nLEZdA.js";import{g as Y,e as _,u as z,S as A,s as J,C as M,a as Q,n as U,p as W,G as Z}from"./GraphPanel-CzT29w7d.js";import{s as I}from"./shallow-BbWNg5yE.js";import"./store-CHJ044RD.js";import"./store-CzlH7EyP.js";import"./store-DWPSX4g-.js";import"./store-CXWocZK6.js";import"./helpers-fab74NUc.js";import"./store-DMyAk-zp.js";import"./store-D1k0Q38A.js";import"./Button-DkAy4TqJ.js";import"./Input-C2xJGQu9.js";import"./CustomSelect-Cj4OeTpF.js";const $=()=>{const d=F(t=>t.addNode,I),{screenToFlowPosition:u}=H();return{onDragOver:R.useCallback(t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},[]),onDrop:t=>{t.preventDefault();const l=t.dataTransfer.getData("application/reactflow"),f=u({x:t.clientX,y:t.clientY}),i=Y(l,f);i&&d(i)}}},tt=()=>{const{nodes:d,edges:u,onNodesChange:D,onEdgesChange:E,addEdge:t}=F(_,I),{onDragOver:l,onDrop:f}=$(),{getNodes:i,getEdges:O}=H(),{enqueueSnackbar:P}=z();return{nodes:d,edges:u,onNodesChange:D,onEdgesChange:E,addEdge:t,onDragOver:l,onDrop:f,isValidConnection:g=>{var w,k,h,T;const m=i(),j=O(),n=g.source??"",C=g.target??"",e=g.sourceHandle,s=g.targetHandle,c=m.find(o=>o.id===n),r=m.find(o=>o.id===C);if(!c||!r||!e||!s)return!1;const N=((w=c.data.outputHandles[e==null?void 0:e.split(" ")[1]])==null?void 0:w.dataType)||((k=c.data.inputHandles[e==null?void 0:e.split(" ")[1]])==null?void 0:k.dataType),S=((h=r.data.inputHandles[s==null?void 0:s.split(" ")[1]])==null?void 0:h.dataType)||((T=r.data.outputHandles[s==null?void 0:s.split(" ")[1]])==null?void 0:T.dataType);if(N!==S)return!1;const y=(o,p=new Set)=>{if(p.has(o.id))return!1;p.add(o.id);for(const x of L(o,m,j))if(x.id===n||y(x,p))return!0;return!1};return n===C?!1:!y(r)},onConnectEnd:(g,m)=>{var h,T,o,p,x,v,G,V;const{fromNode:j,fromHandle:n,toNode:C,toHandle:e,isValid:s}=m,c=b=>b==null?void 0:b.data;if(!j||!C||!(n!=null&&n.id)||!(e!=null&&e.id))return;const r=n.id.split(" ")[1],N=e.id.split(" ")[1],S=c(j),y=c(C),w=((T=(h=S.outputHandles)==null?void 0:h[r])==null?void 0:T.dataType)??((p=(o=S.inputHandles)==null?void 0:o[r])==null?void 0:p.dataType),k=((v=(x=y.inputHandles)==null?void 0:x[N])==null?void 0:v.dataType)??((V=(G=y.outputHandles)==null?void 0:G[N])==null?void 0:V.dataType);w!==k&&s===!1&&P("Нерроектное соединение",{variant:"error"})}}},et=()=>{const{nodes:d,edges:u,onNodesChange:D,onEdgesChange:E,onDragOver:t,onDrop:l,isValidConnection:f,onConnectEnd:i,addEdge:O}=tt();return a.jsx("div",{className:J["graph-editor"],children:a.jsxs(q,{deleteKeyCode:null,proOptions:W,nodeTypes:U,edgeTypes:Q,nodes:d,edges:u,onNodesChange:D,onEdgesChange:E,onConnect:O,onDragOver:t,onDrop:l,connectionLineComponent:M,isValidConnection:f,onConnectEnd:i,fitView:!0,children:[a.jsx(Z,{nodes:d}),a.jsx(K,{}),a.jsx(X,{})]})})},ot=()=>a.jsx(B,{children:a.jsx(A,{maxSnack:3,children:a.jsx(et,{})})}),Tt=()=>a.jsx(ot,{});export{Tt as default};
