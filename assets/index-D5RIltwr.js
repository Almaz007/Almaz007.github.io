import{r as b,j as e,c as w}from"./index-o3mwq-nM.js";import{u as v}from"./store-D6OyahM7.js";import{c as y,s as j}from"./shallow-DV_ax3xe.js";import{B as S}from"./Button-DfzUCmW4.js";import{I as D}from"./Input-EVAo8xw0.js";import{u as k}from"./store-G0C_JJSk.js";const C="_wrapper_1r16a_1",N="_form_1r16a_17",F="_drag_1r16a_29",E="_label_1r16a_43",A="_input_1r16a_49",T="_info_1r16a_93",U="_btns_1r16a_103",i={wrapper:C,form:N,drag:F,"action-title":"_action-title_1r16a_35",label:E,input:A,"file-list":"_file-list_1r16a_63","download-label":"_download-label_1r16a_73",info:T,btns:U,"button-reset":"_button-reset_1r16a_111","button-submit":"_button-submit_1r16a_113"},x=y((a,l)=>({ws:null,status:"disconnected",error:null,messages:[],parseOscilografFile:async t=>{const s=await t.arrayBuffer(),n=new DataView(s);console.log(s);const u={};for(let c=0;c+16<=n.byteLength;c+=16){const o=n.getUint32(c,!0);if(o===0)return;const f=n.getUint32(c+4,!0),d=n.getUint32(c+8,!0),r=n.getUint32(c+12,!0);console.log(`номер: ${o}, метка: ${f}, смещение: ${d}, значение: ${r}`),u[d]||(u[d]={timePoints:[],values:[]}),u[d].timePoints.push(f),u[d].values.push(r)}v.getState().updateOscillographicData(u)},connect:t=>{let{ws:s,parseOscilografFile:n,status:u}=l();s||(a({status:"connecting",error:null}),s=new WebSocket(t),a({ws:s}),s.onopen=()=>{a({error:null,status:"connected"}),console.log("WebSocket connected")},s.onmessage=async g=>{g.data instanceof Blob?(a(c=>({messages:[...c.messages,"Получен бинарный пакет"]})),await n(g.data)):(console.log("Получено с сервера:",g.data),a(c=>({messages:[...c.messages,g.data.toString()]})))},s.onerror=()=>{a({error:"Connection error",status:"disconnected"})},s.onclose=()=>{console.log("WebSocket closed. Status was:",u),s=null,a({ws:null})})},disconnect:()=>{const{ws:t}=l();t&&(t.close(),a({ws:null,status:"disconnected"}))},sendMessage:t=>{const{ws:s}=l();s&&(a(n=>({messages:[...n.messages,t]})),s.send(t))},sendFile:t=>{const{ws:s}=l();s&&(a(n=>({messages:[...n.messages,"Файл отправлен"]})),s.send(t))},sendConfig:t=>{const{ws:s}=l();s&&(a(n=>({messages:[...n.messages,"Конфиг отправлен"]})),s.send(t))}})),W={"controll-block":"_controll-block_2ueij_1"},$=({})=>{const{sendMessage:a}=x(n=>({sendMessage:n.sendMessage})),[l,t]=b.useState(""),s=()=>{a(l),t("")};return e.jsxs("div",{className:W["controll-block"],children:[e.jsx(D,{value:l,onChange:n=>t(n.target.value)}),e.jsx(S,{text:"отправить",onClick:s})]})},B=()=>{const a=x(r=>r.sendFile),[l,t]=b.useState([]),[s,n]=b.useState(!1),u=r=>{r.preventDefault(),r.target.files&&r.target.files[0]&&t([r.target.files[0]])},g=()=>{t([])},c=async r=>{if(r.preventDefault(),!l||l.length===0)return;const m=await l[0].arrayBuffer(),_=new Uint8Array(m),p=new TextEncoder().encode("firmware,"),h=new Uint8Array(p.length+_.length);h.set(p,0),h.set(_,p.length),a(h)},o=function(r){r.preventDefault(),n(!0)},f=function(r){r.preventDefault(),n(!1)},d=function(r){var m;r.preventDefault(),n(!1),(m=r.dataTransfer)!=null&&m.files&&r.dataTransfer.files[0]&&t([r.dataTransfer.files[0]])};return e.jsx("div",{className:w(i.wrapper,{[i.drag]:s}),children:e.jsxs("form",{className:w(i.form),onReset:g,onSubmit:c,onDragEnter:o,onDragOver:o,onDragLeave:f,onDrop:d,children:[e.jsx("h2",{className:i["action-title"],children:"Перетащите файлы сюда"}),e.jsx("p",{children:"или"}),e.jsxs("label",{className:i.label,children:[e.jsx("span",{className:i["download-label"],children:"Загрузите файл"}),e.jsx("input",{className:i.input,type:"file",multiple:!1,onChange:u})]}),l.length>0&&e.jsxs("div",{className:i.info,children:[e.jsx("ul",{className:i["file-list"],children:e.jsx("li",{children:l[0].name})}),e.jsxs("div",{className:i.btns,children:[e.jsx("button",{className:i["button-reset"],type:"reset",children:"Отменить"}),e.jsx("button",{className:i["button-submit"],type:"submit",children:"Отправить"})]})]})]})})},O="_row_q0ihq_1",L={row:O},z=()=>{const[a,l,t,s,n,u]=x(o=>[o.status,o.error,o.messages,o.connect,o.disconnect,o.sendConfig],j),g=k(o=>o.config,j),c=()=>{const o=new TextEncoder().encode(JSON.stringify(g));if(o.length===0){console.log("конфиг не отправлен");return}const f=new TextEncoder().encode("flexibleLogic,"),d=new Uint8Array(f.length+o.length);d.set(f,0),d.set(o,f.length),u(d)};return e.jsxs("div",{children:[e.jsx("h2",{children:"WebSocket"}),e.jsxs("p",{children:["Status: ",a," ",l&&`| Error: ${l}`]}),e.jsx("button",{onClick:()=>s("wss://int-rt.ru:3010"),children:"Подключить"}),e.jsx("br",{}),e.jsx("button",{onClick:n,children:"Отключить"}),e.jsx("div",{style:{height:"300px",overflowY:"auto",border:"1px solid blue",padding:"10px",marginTop:"10px"},children:t.map((o,f)=>e.jsx("p",{children:o},f))}),e.jsx($,{}),e.jsxs("div",{className:L.row,children:[e.jsx(B,{}),e.jsx(S,{onClick:c,text:"загурзить гибкую логику"})]})]})};export{z as default};
