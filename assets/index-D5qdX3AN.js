import{r as f,j as n}from"./index-BjEK62dB.js";import{u as _}from"./store-eAi7euQ0.js";import{c as x,s as w}from"./shallow-BSdIz0rV.js";import{B as j}from"./Button-BQdCRMJp.js";import{I as k}from"./Input-F_Uboj62.js";const h=x((a,i)=>({ws:null,status:"disconnected",error:null,messages:[],parseOscilografFile:async l=>{const s=await l.arrayBuffer(),e=new DataView(s),m={};for(let c=0;c+16<=e.byteLength;c+=16){if(e.getUint32(c,!0)===0)return;const p=e.getUint32(c+4,!0),u=e.getUint32(c+8,!0),t=e.getUint32(c+12,!0);m[u]||(m[u]={timePoints:[],values:[]}),m[u].timePoints.push(p),m[u].values.push(t)}_.getState().updateOscillographicData(m)},connect:l=>{let{ws:s,parseOscilografFile:e,status:m}=i();s||(a({status:"connecting",error:null}),s=new WebSocket(l),a({ws:s}),s.onopen=()=>{a({error:null,status:"connected"}),console.log("WebSocket connected")},s.onmessage=async r=>{r.data instanceof Blob?(a(c=>({messages:[...c.messages,"Получен бинарный пакет"]})),await e(r.data)):(console.log("Получено с сервера:",r.data),a(c=>({messages:[...c.messages,r.data.toString()]})))},s.onerror=()=>{a({error:"Connection error",status:"disconnected"})},s.onclose=()=>{console.log("WebSocket closed. Status was:",m),s=null,a({ws:null})})},disconnect:()=>{const{ws:l}=i();l&&(l.close(),a({ws:null,status:"disconnected"}))},sendMessage:l=>{const{ws:s}=i();s&&(console.log(l),a(e=>({messages:[...e.messages,l]})),s.send(l))}})),y={"controll-block":"_controll-block_2ueij_1"},S=({})=>{const{sendMessage:a}=h(e=>({sendMessage:e.sendMessage})),[i,l]=f.useState(""),s=()=>{a(i),l("")};return n.jsxs("div",{className:y["controll-block"],children:[n.jsx(k,{value:i,onChange:e=>l(e.target.value)}),n.jsx(j,{text:"отправить",onClick:s})]})};function N(a){const[i,l]=f.useState([a]),[s,e]=f.useState(0),[m,r]=f.useState(""),c=i[i.length-1];f.useEffect(()=>{const u=t=>{if(document.activeElement&&document.activeElement.tagName==="INPUT")return;const d=c.items.length;if(d!==0){if(t.key==="ArrowUp")t.preventDefault(),e(o=>o>0?o-1:d-1);else if(t.key==="ArrowDown")t.preventDefault(),e(o=>o<d-1?o+1:0);else if(t.key==="Home")t.preventDefault(),e(0);else if(t.key==="End")t.preventDefault(),e(d-1);else if(t.key==="Enter"){t.preventDefault();const o=c.items[s];if(!o||o.disabled)return;o.children?(l(v=>[...v,{title:o.label,items:o.children}]),e(0)):o.action&&o.action()}else if(t.key==="Backspace"||t.key==="Escape")t.preventDefault(),l(o=>o.length>1?o.slice(0,-1):o),e(0);else if(/^[0-9]$/.test(t.key)){const o=parseInt(t.key,10)-1;o>=0&&o<d&&e(o)}}};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[c,s]);const g=u=>{const t=u-1;if(t>=0&&t<c.items.length){e(t);const d=c.items[t];if(!d||d.disabled)return;d.children?(l(o=>[...o,{title:d.label,items:d.children}]),e(0)):d.action&&d.action()}};return{stack:i,currentMenu:c,selectedIndex:s,inputValue:m,setInputValue:r,setSelectedIndex:e,submitInput:u=>{const t=parseInt(u,10);isNaN(t)||g(t)}}}const D="_container_1bvfg_1",E="_breadcrumbs_1bvfg_25",I="_items_1bvfg_39",M="_item_1bvfg_39",C="_active_1bvfg_75",B="_disabled_1bvfg_85",R="_index_1bvfg_93",V="_label_1bvfg_103",W="_arrow_1bvfg_111",U="_inputRow_1bvfg_119",A="_prompt_1bvfg_131",F="_input_1bvfg_119",L="_help_1bvfg_169",b={container:D,breadcrumbs:E,items:I,item:M,active:C,disabled:B,index:R,label:V,arrow:W,inputRow:U,prompt:A,input:F,help:L},O={title:"Главное меню",items:[{label:"Файлы",children:[{label:"Создать",action:()=>console.log("Создать файл")},{label:"Открыть",action:()=>console.log("Открыть файл")},{label:"Удалить",action:()=>console.log("Удалить файл")}]},{label:"Настройки",children:[{label:"Профиль",action:()=>console.log("Профиль")},{label:"Система",action:()=>console.log("Система")}]},{label:"Выход",action:()=>console.log("Выход")}]},P=({menu:a})=>{const{stack:i,currentMenu:l,selectedIndex:s,inputValue:e,setInputValue:m,setSelectedIndex:r,submitInput:c}=N(a);if(!l)return null;const g=p=>{p.preventDefault(),c(e),m("")};return n.jsxs("div",{className:b.container,children:[n.jsx("div",{className:b.breadcrumbs,children:"> "+i.map(p=>p.title).join(" / ")}),n.jsx("div",{className:b.items,children:l.items.map((p,u)=>{const t=u===s;return n.jsxs("div",{className:[b.item,t?b.active:"",p.disabled?b.disabled:""].join(" "),onMouseDown:d=>{d.preventDefault(),r(u)},children:[n.jsxs("span",{className:b.index,children:[u+1,"."]}),n.jsx("span",{className:b.label,children:p.label}),p.children&&n.jsx("span",{className:b.arrow,children:"›"})]},u)})}),n.jsxs("form",{onSubmit:g,className:b.inputRow,children:[n.jsx("span",{className:b.prompt,children:">"}),n.jsx("input",{className:b.input,value:e,onChange:p=>m(p.target.value),placeholder:"Введите номер пункта...","aria-label":"Выбор пункта по номеру"})]}),n.jsx("div",{className:b.help,children:"↑↓ выбрать • Enter открыть/выполнить • Backspace/Esc назад • [цифра] быстрый выбор • введите номер и Enter"})]})},$=({menu:a})=>{const i=f.useMemo(()=>a??O,[a]);return n.jsx(P,{menu:i})},Y=()=>{const[a,i,l,s,e]=h(r=>[r.status,r.error,r.messages,r.connect,r.disconnect],w),m={title:"Главное меню",items:[{label:"Файлы",children:[{label:"Создать",action:()=>console.log("Создать файл")},{label:"Открыть",action:()=>console.log("Открыть файл")},{label:"Удалить",action:()=>console.log("Удалить файл")}]},{label:"Настройки",children:[{label:"Профиль",action:()=>console.log("Профиль")},{label:"Система",action:()=>console.log("Система")}]},{label:"Выход",action:()=>console.log("Выход")}]};return n.jsxs("div",{children:[n.jsx("h2",{children:"WebSocket"}),n.jsxs("p",{children:["Status: ",a," ",i&&`| Error: ${i}`]}),n.jsx("button",{onClick:()=>s("wss://int-rt.ru:8081"),children:"Подключить"}),n.jsx("br",{}),n.jsx("button",{onClick:e,children:"Отключить"}),n.jsx("div",{style:{height:"300px",overflowY:"auto",border:"1px solid blue",padding:"10px",marginTop:"10px"},children:l.map((r,c)=>n.jsx("p",{children:r},c))}),n.jsx(S,{}),n.jsx($,{menu:m})]})};export{Y as default};
