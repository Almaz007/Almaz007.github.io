import{r as w,j as c,e as L,I as Dt,a as M,k as Nt,l as kt,m as Bt,n as pt,o as wt,u as ot,b as it,d as St,p as $t,q as mt,s as gt,t as yt,v as V,w as jt,x as Ot,y as Mt,E as Lt,z as $,A as Vt,D as et,G as Ft,H as At,J as ft,N as Rt,K as Wt,M as Pt,O as zt,Q as Kt,T as Ut,U as qt,V as Yt,W as Gt,X as Jt,Y as Xt,Z as Zt,_ as Qt,$ as bt,a0 as _t,a1 as te,a2 as ee,a3 as ne,a4 as se,a5 as ht}from"./index-DSBvIpo4.js";import{s as Y}from"./shallow-BHpKla55.js";import{I as J}from"./Input-CspveY7l.js";import{B as st}from"./Button-BQUXm3FT.js";import{i as Ht,a as ae}from"./validators-C1iEiny_.js";const oe="_popup_cjxb8_1",ie="_left_cjxb8_61",re="_center_cjxb8_67",le="_right_cjxb8_75",ce="_visible_cjxb8_81",ue="_popup__label_cjxb8_91",Z={popup:oe,"popup-content":"_popup-content_cjxb8_11",left:ie,center:re,right:le,visible:ce,popup__label:ue},de=({text:t,children:e,position:s})=>{const[n,a]=w.useState(!1),o=w.useRef(null);w.useEffect(()=>{const i=l=>{o.current&&l.target instanceof Node&&!o.current.contains(l.target)&&a(!1)};return document.addEventListener("click",i),()=>{document.removeEventListener("click",i)}},[]);const r=i=>{i.stopPropagation(),a(l=>!l)};return c.jsxs("div",{className:Z.popup,ref:o,children:[c.jsx(st,{text:t,type:"button",onClick:r}),c.jsxs("div",{className:L(Z["popup-content"],Z[s],{[Z.visible]:n}),children:[c.jsx("div",{className:Z.popup__label,children:t}),c.jsx("div",{children:e})]})]})},pe="_container_1y4rw_1",ge="_header_1y4rw_19",ye="_title_1y4rw_51",fe="_arrow_1y4rw_63",he="_rotated_1y4rw_73",me="_content_1y4rw_81",be="_innerContent_1y4rw_91",z={container:pe,header:ge,title:ye,arrow:fe,rotated:he,content:me,innerContent:be},F=({name:t,children:e,defaultOpen:s=!1})=>{const[n,a]=w.useState(s),[o,r]=w.useState(0),i=w.useRef(null);w.useEffect(()=>{i.current&&r(i.current.scrollHeight)},[e]);const l=()=>{a(d=>!d)};return c.jsxs("div",{className:z.container,children:[c.jsxs("button",{className:z.header,onClick:l,"aria-expanded":n,children:[c.jsx("span",{className:z.title,children:t}),c.jsx(Dt,{className:L(z.arrow,{[z.rotated]:n})})]}),c.jsx("div",{ref:i,className:z.content,style:{height:n?`${o}px`:"0px"},"aria-hidden":!n,children:c.jsx("div",{className:z.innerContent,children:e})})]})},En=t=>({nodes:t.nodes,edges:t.edges,onNodesChange:t.onNodesChange,onEdgesChange:t.onEdgesChange,addEdge:t.addEdge,updateNodes:t.updateNodes,updateEdges:t.updateEdges,isDirty:t.isDirty,setDirty:t.setDirty,resetDirty:t.resetDirty}),_e={discreteInput:{outputHandles:{out:{dataType:"bool"}},inputHandles:{},type:"discreteInput",name:""},discreteOutput:{inputHandles:{input:{dataType:"bool"}},outputHandles:{},type:"discreteOutput",name:""},discreteOutputConnect:{inputHandles:{input:{dataType:"bool"}},outputHandles:{},type:"discreteOutputConnect",name:""},discreteInputConnect:{outputHandles:{out:{dataType:"bool"}},inputHandles:{},type:"discreteInputConnect",name:""},analogInputConnect:{outputHandles:{out:{dataType:"analog"}},inputHandles:{},type:"analogInputConnect"},analogOutputConnect:{inputHandles:{input:{dataType:"analog"}},outputHandles:{},type:"analogOutputConnect",name:""},analogInputIntConnect:{outputHandles:{out:{dataType:"int"}},inputHandles:{},type:"analogInputIntConnect"},analogOutputIntConnect:{inputHandles:{input:{dataType:"int"}},outputHandles:{},type:"analogOutputIntConnect"},analogInput:{outputHandles:{out:{dataType:"analog"}},inputHandles:{},type:"analogInput"},analogInputInt:{outputHandles:{out:{dataType:"int"}},inputHandles:{},type:"analogInputInt"},analogOutput:{inputHandles:{input:{dataType:"analog"}},outputHandles:{},type:"analogOutput",name:""},xor:{inputHandles:{"input-1":{dataType:"bool"},"input-2":{dataType:"bool"}},outputHandles:{out:{dataType:"bool"}},type:"xor"},and:{inputHandles:{"input-1":{dataType:"bool"},"input-2":{dataType:"bool"}},outputHandles:{out:{dataType:"bool"}},type:"and"},or:{inputHandles:{"input-1":{dataType:"bool"},"input-2":{dataType:"bool"},"input-3":{dataType:"bool"}},outputHandles:{out:{dataType:"bool"}},type:"or"},nand:{inputHandles:{"input-1":{dataType:"bool"},"input-2":{dataType:"bool"},"input-3":{dataType:"bool"}},outputHandles:{out:{dataType:"bool"}},type:"nand"},nor:{inputHandles:{"input-1":{dataType:"bool"},"input-2":{dataType:"bool"},"input-3":{dataType:"bool"}},outputHandles:{out:{dataType:"bool"}},type:"nor"},notOperation:{inputHandles:{"input-1":{dataType:"bool"}},outputHandles:{out:{dataType:"bool"}},type:"notOperation"},sumInt:{inputHandles:{"input-1":{dataType:"int"},"input-2":{dataType:"int"}},outputHandles:{out:{dataType:"int"}},type:"sumInt"},multInt:{inputHandles:{"input-1":{dataType:"int"},"input-2":{dataType:"int"}},outputHandles:{out:{dataType:"int"}},type:"multInt"},divInt:{inputHandles:{"input-1":{dataType:"int"},"input-2":{dataType:"int"}},outputHandles:{out:{dataType:"int"}},type:"divInt"},subInt:{inputHandles:{"input-1":{dataType:"int"},"input-2":{dataType:"int"}},outputHandles:{out:{dataType:"int"}},type:"subInt"},equalsInt:{inputHandles:{"input-1":{dataType:"int"},"input-2":{dataType:"int"}},outputHandles:{out:{dataType:"bool"}},type:"equalsInt"},lessInt:{inputHandles:{"input-1":{dataType:"int"},"input-2":{dataType:"int"}},outputHandles:{out:{dataType:"bool"}},type:"lessInt"},moreInt:{inputHandles:{"input-1":{dataType:"int"},"input-2":{dataType:"int"}},outputHandles:{out:{dataType:"bool"}},type:"moreInt"},timerInt:{inputHandles:{},outputHandles:{out:{dataType:"int"}},setpointDataType:"int",setpointValue:0,type:"timerInt",name:""},risEdgeTimerBool:{inputHandles:{"input-1":{dataType:"bool"}},outputHandles:{out:{dataType:"bool"}},type:"risEdgeTimerBool",digit:0,name:""},constInt:{inputHandles:{},outputHandles:{out:{dataType:"int"}},setpointDataType:"int",setpointValue:0,type:"constInt",name:""},constBoolean:{inputHandles:{},outputHandles:{out:{dataType:"bool"}},setpointDataType:"int",setpointValue:0,type:"constBoolean",name:""},fourierInt:{inputHandles:{"input-1":{dataType:"analog"}},outputHandles:{"out-1":{dataType:"int"},"out-2":{dataType:"int"}},type:"fourierInt",setpointDataType:"int",setpointValue:[0,0,0,0]},fifoByte:{type:"fifoByte",lengthMemory:1,inputHandles:{"input-1":{dataType:"bool"},"input-2":{dataType:"bool"}},outputHandles:{"out-1":{dataType:"bool"}}},fifoWord:{type:"fifoWord",lengthMemory:1,inputHandles:{"input-1":{dataType:"int"},"input-2":{dataType:"bool"}},outputHandles:{"out-1":{dataType:"int"}}},fifoByteWithoutEn:{type:"fifoByteWithoutEn",lengthMemory:1,inputHandles:{"input-1":{dataType:"bool"}},outputHandles:{"out-1":{dataType:"bool"}}},fifoWordWithoutEn:{type:"fifoWordWithoutEn",lengthMemory:1,inputHandles:{"input-1":{dataType:"int"}},outputHandles:{"out-1":{dataType:"int"}}},dtrigger:{inputHandles:{},outputHandles:{out:{dataType:"bool"}},type:"dtrigger"},rsTrigger:{type:"rsTrigger",name:"",inputHandles:{"input-1":{dataType:"bool"},"input-2":{dataType:"bool"}},outputHandles:{"out-1":{dataType:"bool"}}}},G={discreteInput:{0:{instruction:[34,12,131,199,5,0,35,0,245,0,130,128],lengthInBytes:12,in_type:33}},discreteOutput:{1:{instruction:[34,12,131,199,5,0,35,0,245,0,130,128],lengthInBytes:12,in_type:30}},analogInput:{0:{instruction:[34,12,131,199,5,0,35,0,245,0,130,128],lengthInBytes:12,in_type:33}},analogInputInt:{0:{instruction:[34,12,131,199,5,0,35,0,245,0,130,128],lengthInBytes:12,in_type:34}},analogOutput:{},dtrigger:{},multInt:{2:{instruction:[34,12,156,65,24,66,179,135,231,2,28,193,130,128],lengthInBytes:14,in_type:8}},divInt:{2:{instruction:[34,12,156,65,24,66,179,135,231,2,28,193,130,128],lengthInBytes:14,in_type:45}},subInt:{2:{instruction:[34,12,156,65,24,66,153,143,28,193,130,128],lengthInBytes:12,in_type:8}},sumInt:{2:{instruction:[34,12,156,65,24,66,186,151,28,193,130,128],lengthInBytes:12,in_type:8},3:{instruction:[130,128,24,66,156,65,186,151,152,66,186,151,28,193,130,128],lengthInBytes:16,in_type:9},4:{instruction:[130,128,156,65,16,66,148,66,24,67,178,151,182,151,186,151,28,193,130,128],lengthInBytes:20,in_type:10},5:{instruction:[130,128,140,65,16,66,148,66,24,67,156,67,178,149,182,149,186,149,190,149,12,193,130,128],lengthInBytes:24,in_type:11},6:{instruction:[130,128,140,65,16,66,148,66,24,67,156,67,178,149,182,149,186,149,190,149,131,39,8,0,190,149,12,193,130,128],lengthInBytes:30,in_type:12},7:{instruction:[130,128,140,65,16,66,148,66,24,67,156,67,178,149,182,149,186,149,190,149,131,39,8,0,190,149,131,167,8,0,190,149,12,193,130,128],lengthInBytes:36,in_type:13}},notOperation:{1:{instruction:[34,12,131,199,5,0,147,199,23,0,35,0,245,0,130,128],lengthInBytes:16,in_type:1}},and:{2:{instruction:[34,12,131,199,5,0,3,71,6,0,249,143,35,0,245,0,130,128],lengthInBytes:18,in_type:2},3:{instruction:[130,128,3,199,6,0,131,71,6,0,249,143,3,199,5,0,249,143,35,0,245,0,130,128],lengthInBytes:24,in_type:3},4:{instruction:[130,128,3,71,7,0,131,199,6,0,249,143,3,71,6,0,249,143,3,199,5,0,249,143,35,0,245,0,130,128],lengthInBytes:30,in_type:4},5:{instruction:[130,128,131,199,7,0,3,71,7,0,125,143,131,199,6,0,125,143,131,71,6,0,125,143,131,199,5,0,125,143,35,0,229,0,130,128],lengthInBytes:36,in_type:5},6:{instruction:[130,128,131,199,7,0,3,72,8,0,3,71,7,0,179,247,7,1,249,143,3,199,6,0,249,143,3,71,6,0,249,143,3,199,5,0,249,143,35,0,245,0,130,128],lengthInBytes:44,in_type:6},7:{instruction:[130,128,3,72,8,0,131,200,8,0,131,199,7,0,51,120,24,1,51,120,248,0,131,71,7,0,51,120,248,0,131,199,6,0,51,120,248,0,131,71,6,0,51,120,248,0,131,199,5,0,51,120,248,0,35,0,5,1,130,128],lengthInBytes:60,in_type:7}},nand:{2:{instruction:[34,12,131,199,5,0,3,71,6,0,249,143,147,199,23,0,35,0,245,0,130,128],lengthInBytes:22,in_type:2},3:{instruction:[130,128,3,199,6,0,131,71,6,0,249,143,3,199,5,0,249,143,147,199,23,0,35,0,245,0,130,128],lengthInBytes:28,in_type:3},4:{instruction:[130,128,3,71,7,0,131,199,6,0,249,143,3,71,6,0,249,143,3,199,5,0,249,143,147,199,23,0,35,0,245,0,130,128],lengthInBytes:34,in_type:4},5:{instruction:[130,128,131,199,7,0,3,71,7,0,125,143,131,199,6,0,125,143,131,71,6,0,125,143,131,199,5,0,125,143,19,71,23,0,35,0,229,0,130,128],lengthInBytes:40,in_type:5},6:{instruction:[130,128,131,199,7,0,3,72,8,0,3,71,7,0,179,247,7,1,249,143,3,199,6,0,249,143,3,71,6,0,249,143,3,199,5,0,249,143,147,199,23,0,35,0,245,0,130,128],lengthInBytes:48,in_type:6},7:{instruction:[130,128,3,72,8,0,131,200,8,0,131,199,7,0,51,120,24,1,51,120,248,0,131,71,7,0,51,120,248,0,131,199,6,0,51,120,248,0,131,71,6,0,51,120,248,0,131,199,5,0,51,120,248,0,19,72,24,0,35,0,5,1,130,128],lengthInBytes:64,in_type:7}},nor:{2:{instruction:[34,12,131,199,5,0,3,71,6,0,249,143,147,199,23,0,35,0,245,0,130,128],lengthInBytes:22,in_type:2},3:{instruction:[130,128,3,199,6,0,131,71,6,0,249,143,3,199,5,0,249,143,147,199,23,0,35,0,245,0,130,128],lengthInBytes:28,in_type:3},4:{instruction:[130,128,3,71,7,0,131,199,6,0,249,143,3,71,6,0,249,143,3,199,5,0,249,143,147,199,23,0,35,0,245,0,130,128],lengthInBytes:34,in_type:4},5:{instruction:[130,128,131,199,7,0,3,71,7,0,125,143,131,199,6,0,125,143,131,71,6,0,125,143,131,199,5,0,125,143,19,71,23,0,35,0,229,0,130,128],lengthInBytes:40,in_type:5},6:{instruction:[130,128,131,199,7,0,3,72,8,0,3,71,7,0,179,247,7,1,249,143,3,199,6,0,249,143,3,71,6,0,249,143,3,199,5,0,249,143,147,199,23,0,35,0,245,0,130,128],lengthInBytes:48,in_type:6},7:{instruction:[130,128,3,72,8,0,131,200,8,0,131,199,7,0,51,120,24,1,51,120,248,0,131,71,7,0,51,120,248,0,131,199,6,0,51,120,248,0,131,71,6,0,51,120,248,0,131,199,5,0,51,120,248,0,19,72,24,0,35,0,5,1,130,128],lengthInBytes:64,in_type:7}},or:{2:{instruction:[34,12,131,199,5,0,3,71,6,0,217,143,35,0,245,0,130,128],lengthInBytes:18,in_type:2},3:{instruction:[130,128,3,199,6,0,131,71,6,0,217,143,3,199,5,0,217,143,35,0,245,0,130,128],lengthInBytes:24,in_type:3},4:{instruction:[130,128,3,71,7,0,131,199,6,0,217,143,3,71,6,0,217,143,3,199,5,0,217,143,35,0,245,0,130,128],lengthInBytes:30,in_type:4},5:{instruction:[130,128,131,199,7,0,3,71,7,0,93,143,131,199,6,0,93,143,131,71,6,0,93,143,131,199,5,0,93,143,35,0,229,0,130,128],lengthInBytes:36,in_type:5},6:{instruction:[130,128,131,199,7,0,3,72,8,0,3,71,7,0,179,231,7,1,217,143,3,199,6,0,217,143,3,71,6,0,217,143,3,199,5,0,217,143,35,0,245,0,130,128],lengthInBytes:44,in_type:6},7:{instruction:[130,128,3,72,8,0,131,200,8,0,131,199,7,0,51,104,24,1,51,104,248,0,131,71,7,0,51,104,248,0,131,199,6,0,51,104,248,0,131,71,6,0,51,104,248,0,131,199,5,0,51,104,248,0,35,0,5,1,130,128],lengthInBytes:60,in_type:7}},xor:{2:{instruction:[34,12,131,199,5,0,3,71,6,0,185,143,35,0,245,0,130,128],lengthInBytes:18,in_type:2},3:{instruction:[130,128,3,199,6,0,131,71,6,0,185,143,3,199,5,0,185,143,35,0,245,0,130,128],lengthInBytes:24,in_type:3},4:{instruction:[130,128,3,71,7,0,131,199,6,0,185,143,3,71,6,0,185,143,3,199,5,0,185,143,35,0,245,0,130,128],lengthInBytes:30,in_type:4},5:{instruction:[130,128,131,199,7,0,3,71,7,0,61,143,131,199,6,0,61,143,131,71,6,0,61,143,131,199,5,0,61,143,35,0,229,0,130,128],lengthInBytes:36,in_type:5},6:{instruction:[130,128,131,199,7,0,3,72,8,0,3,71,7,0,179,199,7,1,185,143,3,199,6,0,185,143,3,71,6,0,185,143,3,199,5,0,185,143,35,0,245,0,130,128],lengthInBytes:44,in_type:6},7:{instruction:[130,128,3,72,8,0,131,200,8,0,131,199,7,0,51,72,24,1,51,72,248,0,131,71,7,0,51,72,248,0,131,199,6,0,51,72,248,0,131,71,6,0,51,72,248,0,131,199,5,0,51,72,248,0,35,0,5,1,130,128],lengthInBytes:60,in_type:7}},equalsInt:{2:{instruction:[34,12,152,65,28,66,35,0,5,0,99,21,247,0,133,71,35,0,245,0,130,128],lengthInBytes:22,in_type:26}},equalsFloat:{},moreInt:{2:{instruction:[34,12,152,65,28,66,35,0,5,0,99,213,231,0,133,71,35,0,245,0,130,128],lengthInBytes:22,in_type:26}},moreFloat:{},lessInt:{2:{instruction:[34,12,152,65,28,66,35,0,5,0,99,85,247,0,133,71,35,0,245,0,130,128],lengthInBytes:22,in_type:26}},lessFloat:{},constInt:{0:{instruction:[34,12,156,65,28,193,130,128],lengthInBytes:8,in_type:28}},constBoolean:{0:{instruction:[34,12,131,199,5,0,35,0,245,0,130,128],lengthInBytes:8,in_type:29}},timerInt:{0:{instruction:[34,12,28,65,133,7,28,193,152,65,99,84,247,0,35,32,5,0,130,128],lengthInBytes:20,in_type:27}},risEdgeTimerBool:{1:{instruction:[131,130,5,0,19,3,16,0,99,132,98,0,111,0,192,0,19,3,16,0,35,160,102,0,131,163,6,0,19,14,16,0,99,200,195,3,99,204,195,0,147,3,0,0,35,160,118,0,19,3,0,0,35,0,101,0,103,128,0,0,147,131,19,0,35,160,118,0,19,3,16,0,35,0,101,0,103,128,0,0,19,3,0,0,35,0,101,0,103,128,0,0],lengthInBytes:92,in_type:46}},fourierInt:{1:{instruction:[],lengthInBytes:0,in_type:36},2:{instruction:[],lengthInBytes:0,in_type:37},3:{instruction:[],lengthInBytes:0,in_type:38}},fifoByte:{2:{instruction:[3,71,7,0,13,195,152,67,99,100,183,0,35,160,7,0,131,198,6,0,152,67,42,151,35,0,215,0,152,67,5,7,99,122,183,0,152,195,156,67,62,149,131,71,5,0,35,0,246,0,130,128,35,160,7,0,253,183,130,128],lengthInBytes:60,in_type:41}},fifoWord:{2:{instruction:[3,71,7,0,5,195,152,67,99,100,183,0,35,160,7,0,148,66,152,67,51,71,167,32,20,195,152,67,5,7,99,121,183,0,152,195,156,67,51,197,167,32,28,65,28,194,130,128,35,160,7,0,197,191,130,128],lengthInBytes:56,in_type:42}},fifoByteWithoutEn:{1:{instruction:[28,67,99,228,183,0,35,32,7,0,148,66,28,67,179,199,167,32,148,195,20,67,147,135,22,0,179,181,183,0,179,5,176,64,237,143,28,195,179,199,167,32,156,67,28,194,130,128],lengthInBytes:48,in_type:43}},fifoWordWithoutEn:{1:{instruction:[28,67,99,228,183,0,35,32,7,0,131,198,6,0,28,67,170,151,35,128,215,0,28,67,133,7,179,181,183,0,179,5,176,64,237,143,28,195,62,149,131,71,5,0,35,0,246,0,130,128],lengthInBytes:50,in_type:44}},rsTrigger:{2:{instruction:[131,130,5,0,19,3,16,0,99,138,98,0,131,2,6,0,19,3,16,0,99,138,98,0,103,128,0,0,19,3,16,0,35,0,101,0,111,240,159,254,19,3,0,0,35,0,101,0,103,128,0,0],lengthInBytes:52,in_type:47}}},X={bool:{clr:"#00ff00",selectedClr:"#08d508"},int:{clr:"#368ff4",selectedClr:"#2b79d2"},float:{clr:"#ffe417",selectedClr:"#ead219"},analog:{clr:"#cd1fe8",selectedClr:"#ab2cbe"}},Ie={bool:void 0,analog:void 0,int:"circle",float:"arrow-closed"};function It(t){return{id:t.id,s:t.source,sh:t.sourceHandle,t:t.target,th:t.targetHandle}}function xt(t){const{id:e,position:s,data:n}=t,a={id:e,p:[Math.floor(s.x),Math.floor(s.y)],t:n.type};if(n.name&&(a.nm=n.name),n.inputHandles&&(a.i=Object.fromEntries(Object.entries(n.inputHandles).map(([o,r])=>[o,r.dataType]))),n.outputHandles){const o={};for(const[r,i]of Object.entries(n.outputHandles))o[r]={dataType:i.dataType},i.name&&(o[r].name=i.name),i.oscillography&&(o[r].oscillography=i.oscillography);a.o=o}return"setpointValue"in n&&(a.v=n.setpointValue,a.d=n.setpointDataType,a.um=n.unitOfMeasure),"lengthMemory"in n&&(a.m=n.lengthMemory),"digit"in n&&(a.g=n.digit),a}function xe(t){const e=new Uint8Array(4);return e[3]=t>>24&255,e[2]=t>>16&255,e[1]=t>>8&255,e[0]=t&255,e}const Te=(t,e)=>{const{updateNodeData:s}=M();if(!("setpointDataType"in e)||e.type!=="fourierInt")return;const[n,a]=w.useState([...e.setpointValue]);return{inputsValue:n,handleFourierGarmonicForOutput:(r,i)=>{if(Ht(i)){const l=Number(i);if(!Number.isNaN(l)&&l>=0&&l<=19){const d=[...n];d[r]=l,s(t,{setpointValue:[...d]}),a([...d])}}}}},ve=(t,e)=>{const{updateNodeData:s}=M();if(!("setpointDataType"in e)||Array.isArray(e.setpointValue))return;const{setpointDataType:n}=e,[a,o]=w.useState(String(e.setpointValue)),r=(l,d)=>{if(l===""||l==="-"||l==="."||l==="-.")return l;d&&(l=l.replace(",","."));const f=Number(l);return Number.isNaN(f)?l:String(f)};return{handleChange:l=>{let d=l.target.value;switch(n){case"int":if(Ht(d)){const _=r(d,!1);o(_);const x=Number(_);Number.isNaN(x)||s(t,{setpointValue:x})}break;case"float":if(ae(d)){const _=r(d,!0);o(_);const x=Number(_);Number.isNaN(x)||s(t,{setpointValue:x})}break;case"bool":const h=l.target.checked?1:0;s(t,{setpointValue:h}),o(String(h));break}},inputValue:a}};function Tt(t){return t.map(e=>{const s="digit"in e?[e.inType,e.instructionOffset,...e.resultOffsets,...e.sourcesOffsets,e.digit,e.workingSpace]:"lengthMemory"in e?[e.inType,e.instructionOffset,e.ptrBegin,e.lengthMemory,...e.resultOffsets,...e.sourcesOffsets,e.workingSpace]:"instructionOffset"in e?[e.inType,e.instructionOffset,...e.resultOffsets,...e.sourcesOffsets]:[e.inType,...e.sourcesOffsets,...e.resultOffsets];for(;s.length<10;)s.push(0);return s})}function Ce({flexLogic:t,scripts_1ms:e,scripts_250us:s,instructions:n,setpoints:a,indications:o,inputMatrixData:r,offsetsOsc:i,sms:l,smsWeb:d,phoneNumber:f,characteristics:h}){const _=Tt(e),x=Tt(s),C=Object.values(o).map(({led1:u,led2:y,led3:m,blOn:g,blOff:I,sms:b,smsWeb:p})=>[u,y,m,g,I,b,p]),N=Object.values(r).map(({I:u,U:y,HRM3:m})=>[u,y,m]);let v=[];return Object.entries(i).forEach(u=>{v.push({length:u[1].lengthMemory,offset:Number(u[0])})}),{flexLogic:t,scripts_1ms:_,scripts_250us:x,functions:n,setpoints:a,outputMatrix:C,inputMatrix:N,sms:l,smsWeb:d,phoneNumber:f,offsetsOsc:v,characteristics:h}}const Ne=(t,e,s)=>{if(!e.length)return{newPrimitiveData:{lengthInBytes:t.lengthInBytes,offset:1},newOffset:1,lastLength:t.lengthInBytes};const n=e.slice(-1)[0]+s,a={lengthInBytes:t.lengthInBytes,offset:n};return{newOffset:n,newPrimitiveData:a,lastLength:t.lengthInBytes}},we=()=>({lastLength:0,instructions:[],offsets:[],primitivesData:{}}),q={bool:1,int:4,float:4,analog:160},je=(t,e,s)=>{var o;const n=t.data.type;if(Bt(G).includes(n)&&!((o=s.primitivesData[n])!=null&&o[e])){const r=G[n];if(r&&r[e]){s.instructions.push(...r[e].instruction);const{newOffset:i,newPrimitiveData:l,lastLength:d}=Ne(G[n][e],s.offsets,s.lastLength);s.primitivesData[n]={...s.primitivesData[n],[e]:l},s.offsets.push(i),s.lastLength=d}}},Oe=(t,e)=>{try{const s=Object.keys(e.data.inputHandles);if(s.length===0)return!0;for(const n of s)if(!t.find(o=>o.targetHandle===`${e.id} ${n}`))throw new Error(`Не найдено исходное смещение для handle ${n} узла ${e.id}`)}catch(s){throw new Error(`Ошибка при создании scriptItem для узла ${e.id}: ${s instanceof Error?s.message:String(s)}`)}},He=(t,e,s,n,a,o,r,i)=>{var l,d,f,h,_,x,C,N,v,u,y,m,g,I;try{const{initOscillographicOffsets:b}=pt.getState(),p=t.data.type;if(p==="discreteOutputConnect"||p==="analogOutputConnect"||p==="analogOutputIntConnect")return;const T=p,O=Object.keys(t.data.inputHandles).length;let k;T.includes("Output")?k=[r.get(t.id)]:(k=Object.entries(t.data.outputHandles).map(([E])=>o.get(`${t.id} ${E}`)),Object.entries(t.data.outputHandles).forEach(([E,H])=>{const D=o.get(`${t.id} ${E}`);if(D===void 0)throw new Error(`Не найдено смещение в мапе для handle ${E} узла ${t.id}`);H.oscillography&&b(D,H.name??"",q[H.dataType],H.dataType,H.dataType==="bool"?"line":"block")}));let B=Object.keys(t.data.inputHandles).reduce((E,H)=>{var nt;const D=(nt=e.find(rt=>`${t.id} ${H}`===rt.targetHandle))==null?void 0:nt.sourceHandle;if(!D)throw new Error(`Не найдено исходный handle для handle ${H} узла ${t.id}`);const S=o.get(D);if(S===void 0)throw new Error(`Не найдено исходный узел для handle ${H} узла ${t.id}`);return E.push(S),E},[]);if(t.data.type.includes("analogInput")&&(B=[i.analog.splice(0,q.analog)[0]]),"setpointDataType"in t.data){const{setpointsValues:E,setSetpoints:H}=wt.getState(),D=[...E],S=a[t.data.setpointDataType].splice(0,t.data.setpointDataType==="bool"?1:4)[0];if(t.data.type==="fourierInt")Array.isArray(t.data.setpointValue)&&(D.splice(S,4,...t.data.setpointValue),H([...D]),B.unshift(S));else if(!Array.isArray(t.data.setpointValue))if(t.data.setpointDataType==="bool")D[S]=t.data.setpointValue,H([...D]),B.push(S);else{const nt=t.data.unitOfMeasure==="кВ"?t.data.setpointValue*1e3:t.data.setpointValue,rt=xe(nt);D.splice(S,4,...rt),H([...D]),B.push(S)}}if(T==="fourierInt")return{inType:(d=(l=G[T])==null?void 0:l[O])==null?void 0:d.in_type,sourcesOffsets:B,resultOffsets:k};if("digit"in t.data)return{inType:(h=(f=G[T])==null?void 0:f[O])==null?void 0:h.in_type,instructionOffset:(x=(_=s.primitivesData[T])==null?void 0:_[O])==null?void 0:x.offset,resultOffsets:k,sourcesOffsets:B,digit:t.data.digit,workingSpace:n.int.splice(0,q.int)[0]};if("lengthMemory"in t.data){const E=Object.values(t.data.outputHandles)[0].dataType,H=t.data.lengthMemory,D=n[E].splice(0,H*q[E])[0],S=n.int.splice(0,q.int)[0];return{inType:(N=(C=G[T])==null?void 0:C[O])==null?void 0:N.in_type,instructionOffset:(u=(v=s.primitivesData[T])==null?void 0:v[O])==null?void 0:u.offset,ptrBegin:D,lengthMemory:H,resultOffsets:k,sourcesOffsets:B,workingSpace:S}}return{inType:(m=(y=G[T])==null?void 0:y[O])==null?void 0:m.in_type,instructionOffset:(I=(g=s.primitivesData[T])==null?void 0:g[O])==null?void 0:I.offset,resultOffsets:k,sourcesOffsets:B}}catch(b){throw new Error(`Ошибка при создании scriptItem для узла ${t.id}: ${b instanceof Error?b.message:String(b)}`)}};function Et(t,e,s,n,a,o,r,i,l,d,f){var N,v,u;if(e.has(t.id)||(e.add(t.id),t.data.type==="discreteInputConnect"||t.data.type==="analogInputConnect"||t.data.type==="analogInputIntConnect"))return;t.data.type!=="fourierInt"&&((N=t.data)==null?void 0:N.type)!=="discreteOutputConnect"&&((v=t.data)==null?void 0:v.type)!=="analogOutputConnect"&&((u=t.data)==null?void 0:u.type)!=="analogOutputIntConnect"&&je(t,Object.keys(t.data.inputHandles).length,n);const h=Nt([t],f),{targets:_}=h.reduce((y,m)=>(m.source===t.id&&y.sources.push(m),m.target===t.id&&y.targets.push(m),y),{sources:[],targets:[]});Oe(_,t);const x=kt(t,d,f),C=He(t,_,n,a,r,o,i,l);x.forEach(y=>Et(y,e,s,n,a,o,r,i,l,d,f)),C&&s.push(C)}const Ee=(t,e,s,n)=>{const a=new Map,o=new Map;for(let r of t){const i=r.data.type;if(!(i==="discreteInputConnect"||i==="analogInputConnect"||i==="analogInputIntConnect")){if(i.toLocaleLowerCase().includes("out")&&i!=="discreteOutputConnect"&&i!=="analogOutputConnect"&&i!=="analogOutputIntConnect"){const l=Object.values(r.data.inputHandles)[0].dataType,d=n[l].shift();o.set(r.id,d)}if(i==="discreteOutputConnect"||i==="analogOutputConnect"||i==="analogOutputIntConnect"){const l=e.find(h=>h.target===r.id);if(!l)throw new Error(`Для outputConnect узла ${r.id} не найден входящий edge`);if(!l.sourceHandle)throw new Error(`Для outputConnect узла ${r.id} не найден входящий edge`);const d=t.find(h=>h.id===l.source);if(!d)throw new Error(`Не найден узел-источник ${l.source} для ${r.id}`);let f=a.get(l.sourceHandle);if(f===void 0){const h=Object.values(d.data.outputHandles)[0].dataType,_=s[h].splice(0,q[h])[0];a.set(l.sourceHandle,_),f=_}a.set(`${r.id} out`,f)}Object.entries(r.data.outputHandles).forEach(([l,d])=>{const f=Object.values(r.data.outputHandles)[0].dataType,h=s[f].splice(0,q[f])[0];a.get(`${r.id} ${l}`)||a.set(`${r.id} ${l}`,h)})}}return{handleOffsetsMap:a,outputOffsetsMap:o}},Q=["bool","int","float","analog"],lt=(t,e)=>e===1?t:Math.ceil(t/4)*4,De=(t,e)=>{const s=[];for(let n=t;n<t+e;n++)s.push(n);return s},ke=(t,e,s,n)=>t<=n&&s<=e,Be=(t,e)=>t.map(s=>s+e),K=(t,e,s,n={bool:1,int:4,float:4,analog:160})=>{const a=n[t],o=Q.indexOf(t),r=d=>e[d].length?e[d][e[d].length-1]:null;let i=e[t].length?e[t][e[t].length-1]+1:0;if(e[t].length===0){for(let d=0;d<o;d++){const f=Q[d],h=r(f);h!==null&&(i=Math.max(i,lt(h+1,a)))}i=lt(i,a)}e[t].push(...De(i,s??a));const l=d=>{const f=Q[d],h=e[f];if(!h.length)return;const _=h[0],x=h[h.length-1];for(let C=d+1;C<Q.length;C++){const N=Q[C],v=e[N];if(!v.length)continue;const u=v[0],y=v[v.length-1];if(ke(_,x,u,y)){const m=n[N],I=lt(x+1,m)-u;e[N]=Be(v,I),l(C);return}}};l(o)},Se={bool:1,int:4,float:4,analog:160};function $e(t,e=512){const n=new TextEncoder().encode(t),a=[];let o=0;for(;o<n.length;){const r=n.slice(o,o+e),i=new TextDecoder().decode(r);a.push(i),o+=e}return a}const Dn=()=>{const[t,e,s]=ot(u=>[u.nodes,u.edges,u.resetDirty],Y),[n,a,o]=it(u=>[u.nodes,u.edges,u.resetDirty],Y),[r,i]=St(u=>[u.sendConfig,u.addLog]),[l,d,f,h]=$t(u=>[u.indications,u.smsText,u.smsWebText,u.phoneNumber],Y),[_]=mt(u=>[u.datas,u.characteristicTypeData],Y),x=u=>{const y={bool:[],int:[],float:[],analog:[]},m={bool:[],int:[],float:[],analog:[]},g={bool:[],int:[],float:[],analog:[]},I={bool:[],int:[],float:[],analog:[]};return u.forEach(b=>{Object.values(b.data.outputHandles).forEach(p=>{if(K(p.dataType,y),b.data.type.toLocaleLowerCase().includes("fifo")&&"lengthMemory"in b.data){const T=b.data.lengthMemory,O=Object.values(b.data.outputHandles)[0].dataType,k=T*Se[O];K(p.dataType,y,k),K("int",y)}}),"setpointDataType"in b.data&&K(b.data.setpointDataType,m,void 0,{bool:1,int:4,float:4,analog:4}),b.data.type==="risEdgeTimerBool"&&K("int",y),b.data.type.includes("analogInput")&&K("analog",I,void 0,{bool:1,int:4,float:4,analog:160}),b.data.type.toLocaleLowerCase().includes("output")&&K(b.data.inputHandles.input.dataType,g)}),{offsets:{bool:[...y.bool],int:[...y.int],float:[...y.float],analog:[...y.analog]},setpointOffsets:{bool:[...m.bool],int:[...m.int],float:[...m.float],analog:[...m.analog]},outputOffsetsStore:{bool:[...g.bool],int:[...g.int],float:[...g.float],analog:[...g.analog]},analogInputsOffsets:{bool:[...I.bool],int:[...I.int],float:[...I.float],analog:[...I.analog]}}},C=(u,y,m,g,I,b,p,T,O)=>{const k=[],B=new Set,E=u.filter(H=>{var D;return(D=H.data)==null?void 0:D.type.toLowerCase().includes("output")});return E.length?(E.forEach(H=>Et(H,B,k,p,m,T,g,O,b,u,y)),{scripts:k,instructions:p.instructions}):(console.warn("Нет выходных элементов в этом редакторе"),{scripts:[],instructions:p.instructions})};return{calculateConfig:async()=>{try{const{setConfig:u}=gt.getState(),y=[...t,...n];console.log("Рассчет конфигурации:"),console.log(`  - Редактор 1: ${t.length} нод`),console.log(`  - Редактор 2: ${n.length} нод`);const{offsets:m,setpointOffsets:g,outputOffsetsStore:I,analogInputsOffsets:b}=x(y);pt.getState().clearOscillographicOffsets();const p=we(),{handleOffsetsMap:T,outputOffsetsMap:O}=Ee([...t,...n],[...e,...a],m,I),{scripts:k}=C(t,e,m,g,I,b,p,T,O);console.log(k);const{scripts:B,instructions:E}=C(n,a,m,g,I,b,p,T,O),{oscillographicOffsets:H}=pt.getState(),D=mt.getState().characteristicTypeData,S=Ce({flexLogic:{logic1:{nodes:t.map(xt),edges:e.map(It)},logic2:{nodes:n.map(xt),edges:a.map(It)}},scripts_1ms:k,scripts_250us:B,instructions:E,setpoints:wt.getState().setpointsValues,indications:l,inputMatrixData:_,offsetsOsc:H,sms:d,smsWeb:f,phoneNumber:h,characteristics:D});console.log(S),console.log(S.flexLogic),u({...S}),s(),o(),V(`Конфигурация рассчитана! Редактор 1: ${k.length} скриптов, Редактор 2: ${B.length} скриптов`,{variant:"success"})}catch(u){throw V(u instanceof Error?u.message:"Ошибка сохранения",{variant:"error"}),u}},sendResConfig:()=>{const{config:u}=gt.getState(),y=yt.deflate(JSON.stringify(u.flexLogic)),m=btoa(String.fromCharCode(...y)),g={...u,flexLogic:m};console.log(g),console.log(JSON.stringify(g).length),console.log(JSON.stringify(g));const I=$e(JSON.stringify(g),512);i("Отправка конфигурации..."),I.forEach((b,p)=>{setTimeout(()=>r(b),p*1e3)}),i("Конфигурация была отправлена!","in")}}},kn={"graph-editor":"_graph-editor_3h800_1"},ct={"button-edge__label":"_button-edge__label_t1jz9_1","button-txt":"_button-txt_t1jz9_55",delete:"_delete_t1jz9_81"},Me=({id:t,source:e,sourceHandleId:s,sourceX:n,sourceY:a,targetX:o,targetY:r,selected:i,sourcePosition:l=$.Right,targetPosition:d=$.Left})=>{var p,T,O,k;const{getEdge:f,setEdges:h}=M(),_=jt(B=>B.nodeLookup.get(e),Y),x=f(t);if(!_||!x||!s)return null;const C=s.split(" ")[1],N=_.data.outputHandles[C];if(!N)return null;const{dataType:v}=N,[u,y,m]=Ot({sourceX:n,sourceY:a,targetX:o,targetY:r,sourcePosition:l,targetPosition:d,borderRadius:8,offset:17}),g=i?(p=X[v])==null?void 0:p.selectedClr:(T=X[v])==null?void 0:T.clr,I=Ie[v],b=()=>{h(B=>B.filter(E=>E.id!==x.id))};return c.jsxs(c.Fragment,{children:[c.jsxs("defs",{children:[c.jsx("marker",{id:"circle",viewBox:"0 0 10 10",refX:9,refY:5,markerWidth:7,markerHeight:7,orient:"auto-start-reverse",children:c.jsx("circle",{cx:"6",cy:"5",r:"3",fill:(O=X.int)==null?void 0:O.clr})}),c.jsx("marker",{id:"arrow-closed",viewBox:"0 0 10 10",refX:10,refY:5,markerWidth:8,markerHeight:8,orient:"auto-start-reverse",children:c.jsx("path",{d:"M 0 0 L 10 5 L 0 10 Z",fill:(k=X.float)==null?void 0:k.clr})})]}),c.jsx(Mt,{id:t,path:u,style:{stroke:g,strokeWidth:3},markerEnd:I?`url(#${I})`:void 0}),i&&c.jsx(Lt,{children:c.jsx("div",{className:L(ct["button-edge__label"],"nodrag","nopan"),style:{transform:`translate(-50%, -140%) translate(${y}px,${m}px)`},children:c.jsx("button",{className:L(ct["button-txt"],ct.delete),onClick:b,children:"Удалить"})})})]})};function Le(){const t=w.useRef({x:0,y:0}),e=jt(u=>u.domNode),{getNodes:s,setNodes:n,getEdges:a,setEdges:o,screenToFlowPosition:r}=M(),[i,l]=w.useState([]),[d,f]=w.useState([]);w.useEffect(()=>{if(!e)return;const u=g=>g.preventDefault(),y=g=>{t.current={x:g.clientX,y:g.clientY}},m=["cut","copy","paste"];return m.forEach(g=>e.addEventListener(g,u)),e.addEventListener("mousemove",y),()=>{m.forEach(g=>e.removeEventListener(g,u)),e.removeEventListener("mousemove",y)}},[e]);const h=w.useCallback(()=>{const u=s().filter(g=>g.selected),m=Nt(u,a()).filter(g=>{const I=!u.some(p=>p.id===g.source),b=!u.some(p=>p.id===g.target);return!I&&!b});return{selectedNodes:u,selectedEdges:m}},[s,a]),_=w.useCallback(()=>{const{selectedNodes:u,selectedEdges:y}=h();l(u),f(y)},[h]),x=w.useCallback(()=>{try{const{selectedNodes:u,selectedEdges:y}=h();l(u),f(y),n(m=>m.filter(g=>!g.selected)),o(m=>m.filter(g=>!y.includes(g)))}catch(u){V("Ошибка при вырезании",{variant:"error"}),console.error("Paste error:",u)}},[h,n,o]),C=(u,y,m,g)=>{const I=et.getState().getIdNode(),b=y.x+(u.position.x-m),p=y.y+(u.position.y-g);return{...u,id:I,position:{x:b,y:p},data:{...u.data}}},N=u=>{try{const y=et.getState().getIdNode(),m=u.positionAbsoluteX+20,g=(u.height??140)+10,I=u.positionAbsoluteY+g;let b;b={id:y,type:u.type,position:{x:m,y:I},data:{...u.data},selected:!1},n(p=>[...p.map(T=>({...T,selected:!1})),b])}catch(y){V("Ошибка при копировании",{variant:"error"}),console.error("Paste error:",y)}},v=w.useCallback(async(u=r(t.current))=>{if(i.length)try{const y=Math.min(...i.map(p=>p.position.x)),m=Math.min(...i.map(p=>p.position.y)),g=await Promise.all(i.map(p=>C(p,u,y,m))),I=Object.fromEntries(i.map((p,T)=>[p.id,g[T].id])),b=d.map(p=>{var T,O;return{...p,id:Vt(),source:I[p.source],sourceHandle:`${I[p.source]} ${(T=p.sourceHandle)==null?void 0:T.split(" ")[1]}`,target:I[p.target],targetHandle:`${I[p.target]} ${(O=p.targetHandle)==null?void 0:O.split(" ")[1]}`}});n(p=>[...p.map(T=>({...T,selected:!1})),...g]),o(p=>[...p.map(T=>({...T,selected:!1})),...b])}catch(y){V("Ошибка при копировании",{variant:"error"}),console.error("Paste error:",y)}},[i,d,r,n,o]);return ut(["Meta+x","Control+x"],x),ut(["Meta+c","Control+c"],_),ut(["Meta+v","Control+v"],v),{cut:x,copy:_,paste:v,bufferedNodes:i,bufferedEdges:d,createDublicate:N}}function ut(t,e){w.useEffect(()=>{const s=n=>{const a=n.ctrlKey||n.metaKey,o=n.shiftKey;for(const r of t){const i=r.toLowerCase().split("+"),l=i.includes("control")||i.includes("meta"),d=i.includes("shift"),f=i.find(x=>!["control","meta","shift","alt"].includes(x));if(!f)continue;const h=`Key${f.toUpperCase()}`;if(l===a&&d===o&&n.code===h&&!(document.activeElement instanceof HTMLInputElement)&&!(document.activeElement instanceof HTMLTextAreaElement)){n.preventDefault(),e();break}}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[t,e])}const Ve=()=>{const{setNodes:t,setEdges:e}=M();return{handleDelete:(n,a)=>{if(a.type==="discreteInputConnect"||a.type==="discreteOutputConnect"||a.type==="analogInputConnect"||a.type==="analogOutputConnect"||a.type==="analogInputIntConnect"||a.type==="analogOutputIntConnect"){const o=ot.getState().nodes.filter(i=>i.id!==n),r=it.getState().nodes.filter(i=>i.id!==n);ot.getState().updateNodes(o),it.getState().updateNodes(r);return}t(o=>o.filter(r=>r.id!==n)),e(o=>o.filter(r=>r.target!==n&&r.source!==n))}}},Fe="_row_1sy6z_1",Ae="_input_1sy6z_9",Re="_outputs_1sy6z_19",We="_wraps_1sy6z_29",Pe="_text_1sy6z_49",A={row:Fe,input:Ae,outputs:Re,wraps:We,"handle-wrap":"_handle-wrap_1sy6z_41",text:Pe},ze="_handle_1orw5_1",Ke="_action_1orw5_131",U={handle:ze,"handle-wrapper":"_handle-wrapper_1orw5_17","handle-container":"_handle-container_1orw5_29","oscillography-view":"_oscillography-view_1orw5_37","tooltip-visible":"_tooltip-visible_1orw5_93","context-menu":"_context-menu_1orw5_101",action:Ke},at=({id:t,type:e,position:s,dataType:n,data:a})=>{var b;const[o,r]=w.useState(!1),i=w.useRef(null),{updateNodeData:l}=M(),d=Ft(),[f,h]=w.useMemo(()=>{const[p="",T=""]=String(t).split(" ");return[p,T]},[t]),_=w.useMemo(()=>d.filter(p=>e==="target"?p.targetHandle===`${t}`:p.sourceHandle===`${t}`),[d,t,e]),x=((b=a==null?void 0:a.outputHandles)==null?void 0:b[h])??{},{oscillography:C=!1,name:N=""}=x,v=p=>{l(f,{...a,outputHandles:{...a.outputHandles,[h]:{...x,...p}}})},u=()=>{v({oscillography:!C})},y=p=>{v({name:p.target.value})},m=p=>{p.stopPropagation(),!(!(a!=null&&a.outputHandles)||Object.keys(a.outputHandles).length===0)&&r(T=>!T)};w.useEffect(()=>{if(!o)return;const p=O=>{i.current&&!i.current.contains(O.target)&&r(!1)},T=O=>{O.key==="Escape"&&r(!1)};return document.addEventListener("click",p),document.addEventListener("touchstart",p),document.addEventListener("keydown",T),()=>{document.removeEventListener("click",p),document.removeEventListener("touchstart",p),document.removeEventListener("keydown",T)}},[o]);const g=p=>{p.stopPropagation(),p.key==="Enter"&&(p.target.blur(),r(!1))},I=w.useMemo(()=>{switch(s){case $.Left:return{transform:"translate(-150%, -50%)"};case $.Right:return{transform:"translate(50%, -50%)"};case $.Top:return{transform:"translate(-50%, -150%)"};case $.Bottom:return{transform:"translate(-50%, 50%)"};default:return{transform:"translate(-50%, -150%)"}}},[s]);return c.jsxs("div",{ref:i,onClick:e==="source"?m:void 0,onDoubleClick:p=>p.stopPropagation(),className:L(U["handle-wrapper"],"nodrag","nopan"),children:[e==="source"&&o&&c.jsxs("div",{className:U["context-menu"],role:"menu","aria-label":"Handle context menu",onClick:p=>p.stopPropagation(),children:[c.jsx("label",{children:c.jsx(J,{type:"text",style:{width:"300px"},value:N,onChange:y,placeholder:"Введите название",onKeyDown:g})}),c.jsx("button",{type:"button",className:U.action,onClick:u,children:C?"Выключить осциллографирование":"Осциллографировать"})]}),c.jsxs("div",{className:U["handle-container"],children:[c.jsx(At,{type:e,position:s,id:`${t}`,"data-tooltip":e==="source"?"Нажмите чтобы изменить настройки выхода":void 0,style:{backgroundColor:n?X[n].clr:"gray",transform:s===$.Left?"translate(-100%, -50%)":s===$.Right?"translate(100%, -50%)":s===$.Top?"translate(-50%, -100%)":"translate(-50%, 100%)"},isConnectable:e==="source"?void 0:_.length<1,className:L(U.handle,{[U["tooltip-visible"]]:e==="source"})}),C&&c.jsx("div",{className:U["oscillography-view"],style:I})]})]})},vt={"handles-column":"_handles-column_gcrpe_1","handle-wrap":"_handle-wrap_gcrpe_11"},Ue=({nodeId:t,inputHandles:e,data:s})=>c.jsx("div",{className:vt["handles-column"],children:Object.keys(e).map(n=>c.jsx("div",{className:vt["handle-wrap"],children:c.jsx(at,{id:`${t} ${n}`,type:"target",position:$.Left,dataType:e[n].dataType,data:s})},n))}),qe={analogInput:["updateName","updateSetpointValue","delete","dublicate"],analogInputInt:["updateName","updateSetpointValue","delete","dublicate"],discreteInput:["updateName","delete","dublicate"],discreteOutput:["updateName","delete","dublicate"],constInt:["updateSetpointValue","updateName","delete","dublicate"],fourierInt:["updateName","changeFourierGarmonics","delete","dublicate"],xor:["delete","dublicate"],and:["invert","delete","dublicate"],or:["invert","delete","dublicate"],nand:["invert","delete","dublicate"],nor:["invert","delete","dublicate"],multInt:["delete","dublicate"],divInt:["delete","dublicate"],sumInt:["delete","dublicate"],subInt:["delete","dublicate"],timerInt:["updateSetpointValue","updateName","delete","dublicate"],risEdgeTimerBool:["updateDigit","delete","dublicate"],equalsInt:["delete","dublicate"],lessInt:["delete","dublicate"],moreInt:["delete","dublicate"],fifoByte:["updateLengthMemory","delete","dublicate"],fifoByteWithoutEn:["updateLengthMemory","delete","dublicate"],fifoWord:["updateLengthMemory","delete","dublicate"],fifoWordWithoutEn:["updateLengthMemory","delete","dublicate"],rsTrigger:["delete","dublicate"],analogInputConnect:["delete"],analogOutputConnect:["delete"],analogInputIntConnect:["delete"],analogOutputIntConnect:["delete"],discreteInputConnect:["delete"],discreteOutputConnect:["delete"]},Ye=t=>"setpointDataType"in t,Ge={delete:{key:"deleteNode",label:"delete node",dependencies:["useDeleteNode"],createElement:({node:t,dependencies:e})=>{var r;const{id:s,data:n}=t,a=(r=e.useDeleteNode)==null?void 0:r.call(e);if(!a)return null;const{handleDelete:o}=a;return c.jsx(st,{text:"Удалить",onClick:()=>o(s,n)})}},dublicate:{key:"dublicate",label:"dublicate node",dependencies:["useCopyPaste"],createElement:({node:t,dependencies:e})=>{var a;const s=(a=e.useCopyPaste)==null?void 0:a.call(e);if(!s)return null;const{createDublicate:n}=s;return c.jsx(st,{text:"Дублировать",onClick:()=>n(t)})}},changeFourierGarmonics:{key:"invert",label:"Инвертировать",dependencies:["useUpdateFourierValue"],createElement:({node:t,dependencies:e})=>{const{data:s}=t;if(!("setpointDataType"in s))return;const{outputHandles:n}=s;if(!(e!=null&&e.useUpdateFourierValue))return null;const a=e.useUpdateFourierValue(t.id,t.data);if(!a)return;const{handleFourierGarmonicForOutput:o,inputsValue:r}=a,i=Object.values(n).reduce((l,d,f)=>(f%2===0?l.push([d]):l[l.length-1].push(d),l),[]);return c.jsx("div",{onDoubleClick:l=>{l.stopPropagation()},className:"nodrag nopan nowheel",style:{display:"flex",gap:"10px",width:"max-content"},children:i.map((l,d)=>c.jsx(J,{style:{width:"60px"},type:"number",min:0,value:r[d],onChange:f=>o(d,f.target.value)},d))})}},invert:{key:"invert",label:"Инвертировать",dependencies:["useInverseNode"],createElement:({node:t,dependencies:e})=>{var o;const{id:s,data:n}=t,a=(o=e.useInverseNode)==null?void 0:o.call(e,s,n.type);return c.jsx(st,{onClick:a,text:"Инвертировать",type:"button"})}},updateSetpointValue:{key:"updateSetpointValue",label:"Изменить значение",dependencies:["useUpdateSetpointValue"],createElement:({node:t,dependencies:e})=>{var r;const{data:s}=t;if(!Ye(s))return null;const n=(r=e.useUpdateSetpointValue)==null?void 0:r.call(e,t.id,s);if(!n)return null;const{handleChange:a,inputValue:o}=n;return c.jsx("div",{className:"flex flex-col gap-2",children:c.jsx(J,{type:"text",value:o,onChange:a,placeholder:"Введите значение"})})}},updateName:{key:"updateName",label:"Изменить значение",dependencies:["useUpdateNameValue"],createElement:({node:t,dependencies:e})=>{var i;const{id:s,data:n}=t,a=(i=e.useUpdateNameValue)==null?void 0:i.call(e,s,n);if(!a)return null;const{name:o,handleChangeName:r}=a;return c.jsx("div",{className:"flex flex-col gap-2",children:c.jsx(J,{type:"text",value:o,onChange:r,placeholder:"Введите имя"})})}},updateDigit:{key:"updateDigit",label:"Изменить значение",dependencies:["useUpdateDigit"],createElement:({node:t,dependencies:e})=>{var i;const{id:s,data:n}=t,a=(i=e.useUpdateDigit)==null?void 0:i.call(e,s,n);if(!a)return null;const{digit:o,handleChangeDigit:r}=a;return c.jsx("div",{className:"nodrag nopan nowheel",onDoubleClick:l=>{l.stopPropagation()},children:c.jsx(J,{type:"number",min:0,max:6e3,value:o,onChange:r,placeholder:"Введите значение"})})}},updateLengthMemory:{key:"updateLengthMemory",label:"Изменить значение",dependencies:["useChangeLengthMemory"],createElement:({node:t,dependencies:e})=>{var i;const{id:s,data:n}=t,a=(i=e.useChangeLengthMemory)==null?void 0:i.call(e,s,n);if(!a)return null;const{lengthMemory:o,handleChangeLengthMemory:r}=a;return c.jsx("div",{className:"nodrag nopan nowheel",onDoubleClick:l=>{l.stopPropagation()},children:c.jsx(J,{type:"number",min:1,value:o,onChange:r,placeholder:"Введите глубину"})})}}},Je=t=>Object.values({0:"1",1:"2",2:"3",3:"4",4:"5",5:"6",6:"7",7:"8"}).slice(0,t).reduce((s,n)=>(s[n]=void 0,s),{}),Xe=t=>{const{updateNodeData:e,getEdges:s,setEdges:n,getNode:a}=M(),o=ft(),r=[...new Array(10)].reduce((l,d,f)=>(l.push({value:f+1}),l),[]);return{changeHandles:w.useCallback(l=>{e(t,{inputHandlesCount:l}),o(t);const d=s(),f=Object.keys(Je(+l)).map(_=>`${t} ${_}`),h=d.filter(_=>_.target!==t||_.targetHandle&&f.includes(_.targetHandle));n(h)},[t,e,o,s,n,a]),items:r}},Ze={or:"nor",and:"nand",nor:"or",nand:"and"},Qe=(t,e)=>{const{updateNodeData:s}=M();return w.useCallback(()=>{s(t,{type:Ze[e]})},[t,e,s])},tn=(t,e)=>{const{updateNodeData:s}=M(),n=a=>{const o=a.target.value;s(t,{name:o})};return{name:e.name,handleChangeName:n}},en=(t,e)=>{if(!("lengthMemory"in e))return null;const{updateNodeData:s}=M(),n=a=>{const o=a.target.value;s(t,{lengthMemory:+o})};return{lengthMemory:e.lengthMemory,handleChangeLengthMemory:n}},nn=(t,e)=>{const{updateNodeData:s}=M();if(!("digit"in e))return;const n=a=>{const o=Number(a.target.value);o&&s(t,{digit:o})};return{digit:e.digit,handleChangeDigit:n}},sn=t=>{var a;const{type:e}=t.data,s={useChangeHandles:Xe,useInverseNode:Qe,useUpdateSetpointValue:ve,useUpdateNameValue:tn,useDeleteNode:Ve,useUpdateFourierValue:Te,useCopyPaste:Le,useChangeLengthMemory:en,useUpdateDigit:nn};return{actions:(a=qe[e])==null?void 0:a.map(o=>{const r=Ge[o];if(!r)return null;const i=r.dependencies.reduce((l,d)=>(d in s&&(l[d]=s[d]),l),{});return{key:r.key,label:r.label,element:r.createElement({node:t,dependencies:i})}})}},Ct={"context-menu-block":"_context-menu-block_64p36_1","menu-item":"_menu-item_64p36_15"},an=w.memo(({actions:t,visible:e,setVisible:s})=>{const n=w.useRef(null);return w.useEffect(()=>{const a=o=>{n.current&&!n.current.contains(o.target)&&s(!1)};return document.addEventListener("click",a),()=>document.removeEventListener("click",a)},[]),c.jsx(Rt,{isVisible:e,children:c.jsx("div",{ref:n,className:Ct["context-menu-block"],children:t.map((a,o)=>c.jsx("div",{className:Ct["menu-item"],children:a.element},o))})})}),j=({node:t,children:e})=>{const[s,n]=w.useState(!1),{actions:a}=sn(t);return c.jsxs("div",{style:{position:"relative"},onDoubleClick:()=>n(o=>!o),children:[e,c.jsx(an,{actions:a,visible:s,setVisible:n})]})},on="_inc_1tbfq_1",rn="_dec_1tbfq_9",ln="_disabled_1tbfq_47",tt={"inc-dec":"_inc-dec_1tbfq_1",inc:on,dec:rn,disabled:ln},R=({node:t,children:e})=>{const{id:s,data:n}=t,{updateNodeData:a,setEdges:o}=M(),r=ft(),i=n.inputHandles||{},l=Object.keys(i),d=i[l[0]].dataType,f={min:2,max:10},h=()=>{const N=l.length;if(N>=f.max)return;const v=`input-${N+1}`,u={...i,[v]:{dataType:d}};a(s,{inputHandles:u}),r(s)},_=()=>{if(l.length<=f.min)return;const u=Object.keys(i).filter(g=>g.startsWith("input-")).sort((g,I)=>{const b=parseInt(g.replace("input-",""),10);return parseInt(I.replace("input-",""),10)-b})[0],{[u]:y,...m}=i;o(g=>g.filter(I=>I.targetHandle!==`${s} ${u}`)),a(s,{inputHandles:m}),r(s)},x=l.length>=f.max,C=l.length<=f.min;return c.jsxs("div",{className:tt["inc-dec"],children:[c.jsx("button",{className:L(tt.inc,"nodrag",{[tt.disabled]:x}),onClick:h,disabled:x,children:"+"}),e,c.jsx("button",{className:L(tt.dec,"nodrag",{[tt.disabled]:C}),onClick:_,disabled:C,children:"—"})]})},cn="_btn_aosl1_9",un="_inc_aosl1_1",dn="_disabled_aosl1_41",pn="_dec_aosl1_47",W={"inc-dec":"_inc-dec_aosl1_1","btns-row":"_btns-row_aosl1_9",btn:cn,inc:un,disabled:dn,dec:pn},gn=({node:t,children:e})=>{const{id:s,data:n}=t,{updateNodeData:a,setEdges:o}=M(),r=n.outputHandles||{},i=Object.keys(r),l={min:2,max:6},d=ft(),f=()=>{const C=i.length,N=l.max-C,v=Math.min(2,N);if(v>0){const u={...r};for(let y=1;y<=v;y++){const m=`out-${C+y}`;u[m]={dataType:"int"}}a(s,{outputHandles:u}),d(s)}},h=()=>{const N=i.length-l.min,v=Math.min(2,N);if(v>0){const u={...r},y=Object.keys(u).filter(m=>m.startsWith("out-")).sort((m,g)=>{const I=parseInt(m.replace("out-",""),10);return parseInt(g.replace("out-",""),10)-I});for(let m=0;m<v;m++){const g=y[m];o(I=>I.filter(b=>b.sourceHandle!==`${s} ${g}`)),delete u[g]}a(s,{outputHandles:u}),d(s)}},_=i.length>=l.max,x=i.length<=l.min;return c.jsxs("div",{className:W["inc-dec"],children:[e,c.jsxs("div",{className:W["btns-row"],children:[c.jsx("button",{className:L(W.btn,W.inc,"nodrag",{[W.disabled]:_}),onClick:f,disabled:_,children:"+"}),c.jsx("button",{className:L(W.btn,W.dec,"nodrag",{[W.disabled]:x}),onClick:h,disabled:x,children:"—"})]})]})},yn={analogInput:[j],analogInputInt:[j],discreteInput:[j],discreteOutput:[j],fourierInt:[j,gn],constInt:[j],xor:[j,R],and:[j,R],or:[j,R],nand:[j,R],nor:[j,R],multInt:[j,R],divInt:[j,R],sumInt:[j,R],subInt:[j],timerInt:[j],risEdgeTimerBool:[j],equalsInt:[j],lessInt:[j],moreInt:[j],fifoByte:[j],fifoByteWithoutEn:[j],fifoWord:[j],fifoWordWithoutEn:[j],rsTrigger:[j],analogInputConnect:[j],analogOutputConnect:[j],analogInputIntConnect:[j],analogOutputIntConnect:[j],discreteInputConnect:[j],discreteOutputConnect:[j]},fn=(t,e)=>(yn[t.data.type]||[]).reduce((n,a,o)=>c.jsx(a,{node:t,children:n},`feature-${o}`),e),hn=w.memo(t=>{const{type:e,inputHandles:s,outputHandles:n}=t.data,a=Wt[e];if(!a)return null;const{view:o,...r}=a,i=c.jsxs("div",{className:A.row,children:[!!Object.keys(s).length&&c.jsx(Ue,{nodeId:t.id,inputHandles:s,data:t.data}),c.jsx(o,{...r}),!!Object.keys(n).length&&Object.keys(n).map(f=>c.jsx(at,{id:`${t.id} ${f}`,type:"source",position:$.Right,dataType:n[f].dataType,data:t.data},f))]}),d=e!=="fourierInt"?i:(()=>{const f=Object.keys(s).length,h=Object.keys(s)[0];return c.jsxs("div",{className:A.row,children:[!!f&&c.jsx("div",{className:A.input,children:c.jsx(at,{id:`${t.id} ${h}`,type:"target",position:$.Left,dataType:s[h].dataType,data:t.data},h)}),c.jsx(o,{...r}),!!Object.keys(n).length&&c.jsx("div",{className:A.outputs,children:Array.from({length:Math.ceil(Object.keys(n).length/2)},(_,x)=>Object.keys(n).slice(x*2,x*2+2)).map((_,x)=>c.jsx("div",{className:A.wraps,children:_.map((C,N)=>c.jsxs("div",{className:A["handle-wrap"],children:[N===0?c.jsx("div",{className:A.text,children:"Amp"}):c.jsx("div",{className:A.text,children:"Ph"}),c.jsx(at,{id:`${t.id} ${C}`,type:"source",position:$.Right,dataType:n[C].dataType,data:t.data},`${x}-${N}`)]},C))},x))})]})})();return fn(t,d)}),Bn={account:"paid-pro",hideAttribution:!0};Pt.SmoothStep;const Sn={node:hn},$n={"custom-edge":Me},Mn=({fromX:t,fromY:e,toX:s,toY:n,fromPosition:a,fromHandle:o,toPosition:r,fromNode:i})=>{var f,h,_,x;const[l]=Ot({sourceX:t,sourceY:e,targetX:s,targetY:n,offset:15,sourcePosition:a,targetPosition:r});if(!i||!o||!o.id)return null;const d=((h=i.data.outputHandles[(f=o.id)==null?void 0:f.split(" ")[1]])==null?void 0:h.dataType)||((x=i.data.inputHandles[(_=o.id)==null?void 0:_.split(" ")[1]])==null?void 0:x.dataType);return d?c.jsx("g",{children:c.jsx("path",{fill:"none",stroke:X[d].clr,strokeWidth:3,d:l})}):null},mn="_panel__item_1tehr_15",bn="_name_1tehr_41",dt={"sidebar-item-drag-image":"_sidebar-item-drag-image_1tehr_1",panel__item:mn,name:bn},_n=({viewData:t,type:e})=>{const s=w.useRef(null),{view:n,name:a,...o}=t,r=i=>{var l;(l=i.dataTransfer)==null||l.setData("application/reactflow",e),s.current&&i.dataTransfer.setDragImage(s.current,0,0)};return c.jsxs("div",{className:dt.panel__item,draggable:!0,onDragStart:r,children:[c.jsx(n,{...t}),c.jsx("div",{className:dt.name,children:a}),c.jsx("div",{className:dt["sidebar-item-drag-image"],ref:s,children:c.jsx(n,{...o})})]})},In="_elements_15sbx_1",xn={elements:In},P=({views:t})=>c.jsx("div",{className:xn.elements,children:Object.entries(t).map(e=>c.jsx(_n,{viewData:e[1],type:e[0]},e[0]))}),Ln=()=>c.jsx("div",{children:c.jsxs(de,{text:"Библиотека",position:"right",children:[c.jsx(F,{name:"Входы и выходы",children:c.jsx(P,{views:{...Object.fromEntries(Object.entries(Kt).filter(([t,e])=>t!=="discreteInputConnect"&&t!=="analogInputConnect"&&t!=="analogInputIntConnect")),...zt}})}),c.jsx(F,{name:"Логические элементы",children:c.jsx(P,{views:Ut})}),c.jsx(F,{name:"Алгебраические операции",children:c.jsx(P,{views:qt})}),c.jsx(F,{name:"Операции сравнения",children:c.jsx(P,{views:Yt})}),c.jsx(F,{name:"Выдержки времени",children:c.jsx(P,{views:Gt})}),c.jsx(F,{name:"Фурье",children:c.jsx(P,{views:Jt})}),c.jsx(F,{name:"Fifo",children:c.jsx(P,{views:Xt})}),c.jsx(F,{name:"Триггеры",children:c.jsx(P,{views:Zt})})]})}),Vn=()=>{const[t,e]=ot(r=>[r.updateEdges,r.updateNodes],Y),[s,n]=it(r=>[r.updateEdges,r.updateNodes],Y);return{exportData:()=>{const{config:r}=gt.getState(),i=yt.deflate(JSON.stringify(r.flexLogic)),l=btoa(String.fromCharCode(...i)),d={...r,flexLogic:l};se(JSON.stringify(d),"flexibleLogic.txt","text/plain")},importData:r=>{var d;const i=(d=r.target.files)==null?void 0:d[0];if(!i)return;const l=new FileReader;e([]),t([]),n([]),s([]),l.readAsArrayBuffer(i),l.onload=function(){const f=l.result;if(!f){V("Ошибка сборки данных",{variant:"error"});return}const h=Qt(f);if(console.log(h),!h){V("Ошибка при считывании гибкой логики",{variant:"error"});return}const _=Uint8Array.from(atob(h.flexLogic),b=>b.charCodeAt(0)),x=yt.inflate(_,{to:"string"});h.flexLogic=JSON.parse(x);const{logic1:C,logic2:N}=h.flexLogic,v=C.nodes.map(bt),u=N.nodes.map(bt),y=C.edges.map(_t),m=N.edges.map(_t);e(v),t(y),n(u),s(m),te(h.inputMatrix,v,u),ee(h.outputMatrix,v,u),ne(h.characteristics);const g=[...v,...u].reduce((b,p)=>{const T=Number(p.id);return T>b?T:b},0),I=[...y,...m].reduce((b,p)=>{const T=Number(p.id);return T>b?T:b},0);console.log(g,I),et.getState().setIdNode(String(g)),et.getState().setIdEdge(String(I))}}}},Tn="_disabled_1h3jv_95",vn="_ie_1h3jv_119",Fn={"action-panel":"_action-panel_1h3jv_1","icon-block":"_icon-block_1h3jv_19","action-icon":"_action-icon_1h3jv_77",disabled:Tn,ie:vn,"button-tooltip":"_button-tooltip_1h3jv_187"};function An(t){return ht({attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{id:"Export"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{d:"M5.552,20.968a2.577,2.577,0,0,1-2.5-2.73c-.012-2.153,0-4.306,0-6.459a.5.5,0,0,1,1,0c0,2.2-.032,4.4,0,6.6.016,1.107.848,1.589,1.838,1.589H18.353A1.546,1.546,0,0,0,19.825,19a3.023,3.023,0,0,0,.1-1.061V11.779h0a.5.5,0,0,1,1,0c0,2.224.085,4.465,0,6.687a2.567,2.567,0,0,1-2.67,2.5Z"},child:[]},{tag:"path",attr:{d:"M12.337,3.176a.455.455,0,0,0-.311-.138c-.015,0-.028,0-.043-.006s-.027,0-.041.006a.457.457,0,0,0-.312.138L7.961,6.845a.5.5,0,0,0,.707.707l2.816-2.815V15.479a.5.5,0,0,0,1,0V4.737L15.3,7.552a.5.5,0,0,0,.707-.707Z"},child:[]}]}]}]})(t)}function Rn(t){return ht({attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{id:"Import"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{d:"M5.552,20.968a2.577,2.577,0,0,1-2.5-2.73c-.012-2.153,0-4.306,0-6.459a.5.5,0,0,1,1,0c0,2.2-.032,4.4,0,6.6.016,1.107.848,1.589,1.838,1.589H18.353A1.546,1.546,0,0,0,19.825,19a3.023,3.023,0,0,0,.1-1.061V11.779h0a.5.5,0,0,1,1,0c0,2.224.085,4.465,0,6.687a2.567,2.567,0,0,1-2.67,2.5Z"},child:[]},{tag:"path",attr:{d:"M11.63,15.818a.459.459,0,0,0,.312.138c.014,0,.027.005.042.006s.027,0,.041-.006a.457.457,0,0,0,.312-.138l3.669-3.669a.5.5,0,0,0-.707-.707l-2.815,2.815V3.515a.5.5,0,0,0-1,0V14.257L8.668,11.442a.5.5,0,0,0-.707.707Z"},child:[]}]}]}]})(t)}const Cn=t=>{const e={type:t.type,inputHandles:t.inputHandles,outputHandles:t.outputHandles,...t.name&&{name:t.name}};return"lengthMemory"in t?{...e,lengthMemory:t.lengthMemory}:"digit"in t?{...e,digit:t.digit}:"setpointDataType"in t?{...e,setpointDataType:t.setpointDataType,setpointValue:t.setpointValue}:e},Wn=(t,e)=>{const s=_e[t];if(!s)return V(`Неизвестный тип узла: ${t}`,{variant:"error"}),null;const n=Cn(s);return n?{id:et.getState().getIdNode(),type:"node",position:e,data:{...n}}:(V("Не удалось выделить память",{variant:"error"}),null)};function Pn(t){return ht({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M224 30v256h-64l96 128 96-128h-64V30h-64zM32 434v48h448v-48H32z"},child:[]}]})(t)}export{Rn as C,Pn as G,Ln as L,Le as a,Vn as b,An as c,kn as d,En as e,Mn as f,Wn as g,$n as h,Sn as i,_e as n,Bn as p,Fn as s,Dn as u};
