import{u as k,b as R,r as m,j as s,O as F}from"./index-CrREYRkc.js";import{B as w}from"./Button-C6bKAtMY.js";import{I}from"./Input-i71ZKPRw.js";import{T as B}from"./Table-BkhC7I51.js";import{M as K}from"./Modal-BOWmQpx7.js";import{u as V}from"./store-CwyoiMnS.js";import{C as A}from"./CheckBox-CS0Fa-BW.js";import{s as S}from"./shallow-BHpKla55.js";const H=({id:x,value:y})=>{const{nodes:j,updateNodes:_}=k(o=>({nodes:o.nodes,updateNodes:o.updateNodes}),S),{nodes2:c,updateNodes2:b}=R(o=>({nodes2:o.nodes,updateNodes2:o.updateNodes}),S),d=m.useMemo(()=>j.find(o=>o.id===x),[j]),l=m.useMemo(()=>c.find(o=>o.id===x),[c]);if(!d&&!l)return s.jsx("div",{children:"узел не найден"});const f=d?o=>{const a={...d,data:{...d==null?void 0:d.data,name:o}},i=j.map(u=>u.id===a.id?a:u);_(i)}:l?o=>{const a={...l,data:{...l==null?void 0:l.data,name:o}},i=c.map(u=>u.id===a.id?a:u);b(i)}:()=>{};return s.jsx(I,{value:y,onChange:o=>f(o.target.value)})},M={led1:0,led2:0,led3:0,blOn:0,blOff:0,sms:0,smsWeb:0},D=["id","name"],L=()=>{const{smsText:x,setSms:y,smsWebText:j,setSmsWeb:_,indications:c,setIndications:b,phoneNumber:d,setPhoneNumber:l}=V(e=>({indications:e.indications,setIndications:e.setIndications,smsText:e.smsText,setSms:e.setSms,smsWebText:e.smsWebText,setSmsWeb:e.setSmsWeb,phoneNumber:e.phoneNumber,setPhoneNumber:e.setPhoneNumber}),S),[f,o]=k(e=>[e.nodes,e.setDirty],S),[a,i]=R(e=>[e.nodes,e.setDirty],S);m.useEffect(()=>{const r=[...f,...a].filter(n=>{var t,p,v,W,E;return((p=(t=n==null?void 0:n.data)==null?void 0:t.type)==null?void 0:p.toLowerCase().includes("output"))&&((v=n==null?void 0:n.data)==null?void 0:v.type)!=="discreteOutputConnect"&&((W=n==null?void 0:n.data)==null?void 0:W.type)!=="analogOutputConnect"&&((E=n==null?void 0:n.data)==null?void 0:E.type)!=="analogOutputIntConnect"}).reduce((n,t)=>(n[t.id]={...c[t.id]??M,id:t.id,name:t.data.name??""},n),{});b(r)},[f,a]);const u=m.useMemo(()=>Object.values(c),[c]),N=(e,r)=>{o(),i();const n=c[e],t=Object.entries(c).find(([p,v])=>v[r]===1);t&&t[0]!==e||b({...c,[e]:{...n,[r]:n[r]?0:1}})},g=(e,r)=>{D.includes(r)||N(e,r)},C=m.useMemo(()=>F({id:"",name:"",...M}),[]);return{renderHead:()=>C.map(e=>s.jsx("th",{children:e},e)),renderRow:e=>s.jsx(s.Fragment,{children:C.map(r=>{const n=!D.includes(r);return s.jsx("td",{style:{cursor:n?"pointer":"default"},children:r==="name"?s.jsx(H,{value:e.name,id:e.id}):n?s.jsx(A,{checked:!!e[r],onChange:()=>g(e.id,r)}):e[r]},r)})}),rows:u,smsText:x,setSms:y,smsWebText:j,setSmsWeb:_,phoneNumber:d,setPhoneNumber:l}},U="_content_y9eit_11",$="_title_y9eit_17",h={"btns-row":"_btns-row_y9eit_1",content:U,title:$,"controlled-block":"_controlled-block_y9eit_23","input-row":"_input-row_y9eit_35","input-label":"_input-label_y9eit_43","error-text":"_error-text_y9eit_53"},P=x=>/^\+?\d{10,15}$/.test(x),q=()=>{const{renderHead:x,renderRow:y,rows:j,smsText:_,setSms:c,smsWebText:b,setSmsWeb:d,phoneNumber:l,setPhoneNumber:f}=L(),[o,a]=m.useState(!1),[i,u]=m.useState("sms"),[N,g]=m.useState({sms:{title:"СМС",value:_},smsWeb:{title:"udp СМС",value:b},phoneNumber:l}),[C,O]=m.useState(!0);m.useEffect(()=>{g({sms:{title:"СМС",value:_},smsWeb:{title:"СМС UDP",value:b},phoneNumber:l})},[_,b,l]);const T=(t,p)=>{g(v=>({...v,[t]:{...v[t],value:p}}))},e=t=>{g(p=>({...p,phoneNumber:t})),O(P(t))},r=()=>{const{value:t}=N[i],p=N.phoneNumber;i==="sms"?(c(t),f(p)):d(t),a(!1)},n=i==="sms"&&!P(N.phoneNumber);return s.jsxs("div",{children:[s.jsx(B,{renderRow:y,renderHead:x,rowItems:j,getRowKey:t=>t.id,maxWidth:1100}),s.jsxs("div",{className:h["btns-row"],children:[s.jsx(w,{text:"смс",onClick:()=>{a(!0),u("sms")}}),s.jsx(w,{text:"смс udp",onClick:()=>{a(!0),u("smsWeb")}})]}),s.jsx(K,{visible:o,setVisible:a,children:s.jsxs("div",{className:h.content,children:[s.jsx("h2",{className:h.title,children:N[i].title}),s.jsxs("div",{className:h["controlled-block"],children:[s.jsxs("div",{className:h["input-row"],children:[s.jsx("label",{className:h["input-label"],children:"Сообщение"}),s.jsx(I,{value:N[i].value,onChange:t=>T(i,t.target.value)})]}),i==="sms"&&s.jsxs("div",{className:h["input-row"],children:[s.jsx("label",{className:h["input-label"],children:"Номер телефона:"}),s.jsx(I,{value:N.phoneNumber,onChange:t=>e(t.target.value),style:{borderColor:C?void 0:"red"}}),!C&&s.jsx("span",{className:h["error-text"],children:"Неверный номер телефона"})]}),s.jsx(w,{text:"Сохранить",onClick:r,disabled:n})]})]})})]})},se=()=>s.jsx(q,{});export{se as default};
