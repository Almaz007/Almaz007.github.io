import{r as f,j as t}from"./index-C_4yp_nz.js";import{T as V}from"./Table-CZKWmZGe.js";import{u as j,b}from"./store2-CD7zKPG9.js";import{g as w}from"./helpers-fab74NUc.js";import{I as D}from"./Input-C16kTWuA.js";import{i as F,a as C}from"./store-DozRHJEM.js";import{s as g}from"./shallow-CDFTM4LJ.js";const T=(n,o,u)=>{if(!("setpointDataType"in o)||o.type!=="fourierInt")return;const[l,p]=f.useState([...o.setpointValue]),s=f.useCallback(c=>{u(n,{setpointValue:c})},[n,u]);return{inputsValue:l,handleFourierGarmonicForOutput:(c,N)=>{if(F(N)){const e=Number(N);if(!Number.isNaN(e)&&e>=0&&e<=19){const r=[...l];r[c]=e,s([...r]),p([...r])}}}}},k=(n,o,u)=>{if(!("setpointDataType"in o)||Array.isArray(o.setpointValue))return;console.log(n);const{setpointDataType:l}=o,[p,s]=f.useState(String(o.setpointValue)),i=f.useCallback(e=>{u(n,{setpointValue:e})},[n,u]),c=(e,r)=>{if(e===""||e==="-"||e==="."||e==="-.")return e;r&&(e=e.replace(",","."));const m=Number(e);return Number.isNaN(m)?e:String(m)};return{handleChange:e=>{let r=e.target.value;switch(l){case"int":if(F(r)){const h=c(r,!1);s(h);const a=Number(h);Number.isNaN(a)||i(a)}break;case"float":if(C(r)){const h=c(r,!0);s(h);const a=Number(h);Number.isNaN(a)||i(a)}break;case"bool":const d=e.target.checked?1:0;i(d),s(String(d));break}},inputValue:p}},S=({id:n,value:o})=>{const{nodes:u,updateNodes:l}=j(e=>({nodes:e.nodes,updateNodes:e.updateNodes}),g),{nodes2:p,updateNodes2:s}=b(e=>({nodes2:e.nodes,updateNodes2:e.updateNodes}),g),i=f.useMemo(()=>u.find(e=>e.id===n),[u]),c=f.useMemo(()=>p.find(e=>e.id===n),[p]);if(!i&&!c)return t.jsx("div",{children:"узел не найден"});const N=i?e=>{const r={...i,data:{...i==null?void 0:i.data,name:e}},m=u.map(d=>d.id===r.id?r:d);l(m)}:c?e=>{const r={...c,data:{...c==null?void 0:c.data,name:e}},m=p.map(d=>d.id===r.id?r:d);s(m)}:()=>{};return t.jsx(D,{value:o,onChange:e=>N(e.target.value)})},R=({id:n,data:o})=>{const{setNodeData1:u,nodes:l}=j(d=>({setNodeData1:d.setNodeData,nodes:d.nodes}),g),{setNodeData2:p,nodes2:s}=b(d=>({setNodeData2:d.setNodeData,nodes2:d.nodes}),g),{type:i,name:c}=o,N=l.find(d=>d.id===n)?u:s.find(d=>d.id===n)?p:()=>({}),e=k(n,o,N);if(!e)return t.jsx(t.Fragment,{});const{handleChange:r,inputValue:m}=e;return t.jsxs(t.Fragment,{children:[t.jsx("td",{children:n},0),t.jsx("td",{children:i},1),t.jsx("td",{children:t.jsx(S,{value:c??"",id:n})},2),t.jsx("td",{children:t.jsx(D,{type:"text",value:m,onChange:r})},3)]})},E=({id:n,data:o})=>{const{setNodeData1:u,nodes:l}=j(a=>({setNodeData1:a.setNodeData,nodes:a.nodes})),{setNodeData2:p,nodes2:s}=b(a=>({setNodeData2:a.setNodeData,nodes2:a.nodes})),i=l.find(a=>a.id===n)?u:s.find(a=>a.id===n)?p:()=>({}),{type:c,name:N,outputHandles:e}=o,r=T(n,o,i);if(!r)return t.jsx(t.Fragment,{});const{handleFourierGarmonicForOutput:m,inputsValue:d}=r,h=Object.values(e).reduce((a,x,y)=>(y%2===0?a.push([x]):a[a.length-1].push(x),a),[]);return t.jsxs(t.Fragment,{children:[t.jsx("td",{children:n},0),t.jsx("td",{children:c},1),t.jsx("td",{children:t.jsx(S,{value:N??"",id:n})},2),t.jsx("td",{style:{display:"flex",gap:"10px"},children:h.map((a,x)=>t.jsx(D,{style:{width:"60px"},type:"number",value:d[x],onChange:y=>m(x,y.target.value)},x))},3)]})},H={id:"",type:"",name:"",value:0};function I(n){return"setpointDataType"in n.data}const O=()=>{const n=j(s=>s.nodes,g),o=b(s=>s.nodes,g),u=f.useMemo(()=>[...n,...o].filter(i=>I(i)).map(i=>({id:i.id,data:i.data})),[n,o]);return{renderHead:()=>t.jsx(t.Fragment,{children:w(H).map(s=>t.jsx("th",{children:s},s))}),rows:u,renderRow:s=>s.data.type==="fourierInt"?t.jsx(E,{id:s.id,data:s.data}):t.jsx(R,{id:s.id,data:s.data})}},A=({})=>{const{renderHead:n,rows:o,renderRow:u}=O();return console.log(o),t.jsx("div",{children:t.jsx(V,{rowItems:o,renderHead:n,renderRow:u,getRowKey:l=>l.id,maxWidth:1e3})})},L=()=>t.jsx("div",{children:t.jsx(A,{})});export{L as default};
