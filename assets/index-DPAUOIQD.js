import{u as k,b as R,r as m,j as s,p as F,m as B}from"./index-Cbj21JmJ.js";import{B as w}from"./Button-CkPxRVNX.js";import{I}from"./Input-BiIIJ4QV.js";import{T as K}from"./Table-WpjJJ0XE.js";import{M as V}from"./Modal-CbQvLOg6.js";import{C as A}from"./CheckBox-ON0Q13XW.js";import{s as f}from"./shallow-BHpKla55.js";const H=({id:x,value:y})=>{const{nodes:j,updateNodes:_}=k(o=>({nodes:o.nodes,updateNodes:o.updateNodes}),f),{nodes2:c,updateNodes2:b}=R(o=>({nodes2:o.nodes,updateNodes2:o.updateNodes}),f),d=m.useMemo(()=>j.find(o=>o.id===x),[j]),l=m.useMemo(()=>c.find(o=>o.id===x),[c]);if(!d&&!l)return s.jsx("div",{children:"узел не найден"});const g=d?o=>{const r={...d,data:{...d==null?void 0:d.data,name:o}},i=j.map(u=>u.id===r.id?r:u);_(i)}:l?o=>{const r={...l,data:{...l==null?void 0:l.data,name:o}},i=c.map(u=>u.id===r.id?r:u);b(i)}:()=>{};return s.jsx(I,{value:y,onChange:o=>g(o.target.value)})},M={led1:0,led2:0,led3:0,blOn:0,blOff:0,sms:0,smsWeb:0},D=["id","name"],L=()=>{const{smsText:x,setSms:y,smsWebText:j,setSmsWeb:_,indications:c,setIndications:b,phoneNumber:d,setPhoneNumber:l}=F(e=>({indications:e.indications,setIndications:e.setIndications,smsText:e.smsText,setSms:e.setSms,smsWebText:e.smsWebText,setSmsWeb:e.setSmsWeb,phoneNumber:e.phoneNumber,setPhoneNumber:e.setPhoneNumber}),f),[g,o]=k(e=>[e.nodes,e.setDirty],f),[r,i]=R(e=>[e.nodes,e.setDirty],f);m.useEffect(()=>{const a=[...g,...r].filter(n=>{var t,p,v,W,E;return((p=(t=n==null?void 0:n.data)==null?void 0:t.type)==null?void 0:p.toLowerCase().includes("output"))&&((v=n==null?void 0:n.data)==null?void 0:v.type)!=="discreteOutputConnect"&&((W=n==null?void 0:n.data)==null?void 0:W.type)!=="analogOutputConnect"&&((E=n==null?void 0:n.data)==null?void 0:E.type)!=="analogOutputIntConnect"}).reduce((n,t)=>(n[t.id]={...c[t.id]??M,id:t.id,name:t.data.name??""},n),{});b(a)},[g,r]);const u=m.useMemo(()=>Object.values(c),[c]),N=(e,a)=>{o(),i();const n=c[e],t=Object.entries(c).find(([p,v])=>v[a]===1);t&&t[0]!==e||b({...c,[e]:{...n,[a]:n[a]?0:1}})},C=(e,a)=>{D.includes(a)||N(e,a)},S=m.useMemo(()=>B({id:"",name:"",...M}),[]);return{renderHead:()=>S.map(e=>s.jsx("th",{children:e},e)),renderRow:e=>s.jsx(s.Fragment,{children:S.map(a=>{const n=!D.includes(a);return s.jsx("td",{style:{cursor:n?"pointer":"default"},children:a==="name"?s.jsx(H,{value:e.name,id:e.id}):n?s.jsx(A,{checked:!!e[a],onChange:()=>C(e.id,a)}):e[a]},a)})}),rows:u,smsText:x,setSms:y,smsWebText:j,setSmsWeb:_,phoneNumber:d,setPhoneNumber:l}},U="_content_y9eit_11",$="_title_y9eit_17",h={"btns-row":"_btns-row_y9eit_1",content:U,title:$,"controlled-block":"_controlled-block_y9eit_23","input-row":"_input-row_y9eit_35","input-label":"_input-label_y9eit_43","error-text":"_error-text_y9eit_53"},P=x=>/^\+?\d{10,15}$/.test(x),q=()=>{const{renderHead:x,renderRow:y,rows:j,smsText:_,setSms:c,smsWebText:b,setSmsWeb:d,phoneNumber:l,setPhoneNumber:g}=L(),[o,r]=m.useState(!1),[i,u]=m.useState("sms"),[N,C]=m.useState({sms:{title:"СМС",value:_},smsWeb:{title:"udp СМС",value:b},phoneNumber:l}),[S,T]=m.useState(!0);m.useEffect(()=>{C({sms:{title:"СМС",value:_},smsWeb:{title:"СМС UDP",value:b},phoneNumber:l})},[_,b,l]);const O=(t,p)=>{C(v=>({...v,[t]:{...v[t],value:p}}))},e=t=>{C(p=>({...p,phoneNumber:t})),T(P(t))},a=()=>{const{value:t}=N[i],p=N.phoneNumber;i==="sms"?(c(t),g(p)):d(t),r(!1)},n=i==="sms"&&!P(N.phoneNumber);return s.jsxs("div",{children:[s.jsx(K,{renderRow:y,renderHead:x,rowItems:j,getRowKey:t=>t.id,maxWidth:1100}),s.jsxs("div",{className:h["btns-row"],children:[s.jsx(w,{text:"смс",onClick:()=>{r(!0),u("sms")}}),s.jsx(w,{text:"смс udp",onClick:()=>{r(!0),u("smsWeb")}})]}),s.jsx(V,{visible:o,setVisible:r,children:s.jsxs("div",{className:h.content,children:[s.jsx("h2",{className:h.title,children:N[i].title}),s.jsxs("div",{className:h["controlled-block"],children:[s.jsxs("div",{className:h["input-row"],children:[s.jsx("label",{className:h["input-label"],children:"Сообщение"}),s.jsx(I,{value:N[i].value,onChange:t=>O(i,t.target.value)})]}),i==="sms"&&s.jsxs("div",{className:h["input-row"],children:[s.jsx("label",{className:h["input-label"],children:"Номер телефона:"}),s.jsx(I,{value:N.phoneNumber,onChange:t=>e(t.target.value),style:{borderColor:S?void 0:"red"}}),!S&&s.jsx("span",{className:h["error-text"],children:"Неверный номер телефона"})]}),s.jsx(w,{text:"Сохранить",onClick:a,disabled:n})]})]})})]})},ee=()=>s.jsx(q,{});export{ee as default};
