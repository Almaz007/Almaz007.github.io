import{r as h,j as t,c as x}from"./index-BU8NbYXv.js";import{u as v}from"./store-Dai1LUXj.js";import{c as y,s as k}from"./shallow-CwuyXiz3.js";import{B as D}from"./Button-lk4izw_4.js";import{I as w}from"./Input-CdhHZoS4.js";const N="_wrapper_1r16a_1",S="_form_1r16a_17",E="_drag_1r16a_29",C="_label_1r16a_43",I="_input_1r16a_49",M="_info_1r16a_93",$="_btns_1r16a_103",p={wrapper:N,form:S,drag:E,"action-title":"_action-title_1r16a_35",label:C,input:I,"file-list":"_file-list_1r16a_63","download-label":"_download-label_1r16a_73",info:M,btns:$,"button-reset":"_button-reset_1r16a_111","button-submit":"_button-submit_1r16a_113"},g=y((r,a)=>({ws:null,status:"disconnected",error:null,messages:[],parseOscilografFile:async l=>{const n=await l.arrayBuffer(),s=new DataView(n);console.log(n);const m={};for(let c=0;c+16<=s.byteLength;c+=16){const _=s.getUint32(c,!0);if(_===0)return;const f=s.getUint32(c+4,!0),d=s.getUint32(c+8,!0),e=s.getUint32(c+12,!0);console.log(`номер: ${_}, метка: ${f}, смещение: ${d}, значение: ${e}`),m[d]||(m[d]={timePoints:[],values:[]}),m[d].timePoints.push(f),m[d].values.push(e)}v.getState().updateOscillographicData(m)},connect:l=>{let{ws:n,parseOscilografFile:s,status:m}=a();n||(r({status:"connecting",error:null}),n=new WebSocket(l),r({ws:n}),n.onopen=()=>{r({error:null,status:"connected"}),console.log("WebSocket connected")},n.onmessage=async u=>{u.data instanceof Blob?(r(c=>({messages:[...c.messages,"Получен бинарный пакет"]})),await s(u.data)):(console.log("Получено с сервера:",u.data),r(c=>({messages:[...c.messages,u.data.toString()]})))},n.onerror=()=>{r({error:"Connection error",status:"disconnected"})},n.onclose=()=>{console.log("WebSocket closed. Status was:",m),n=null,r({ws:null})})},disconnect:()=>{const{ws:l}=a();l&&(l.close(),r({ws:null,status:"disconnected"}))},sendMessage:l=>{const{ws:n}=a();n&&(r(s=>({messages:[...s.messages,l]})),n.send(l))},sendFile:l=>{const{ws:n}=a();n&&(r(s=>({messages:[...s.messages,"файл отправлен"]})),n.send(l))}})),B={"controll-block":"_controll-block_2ueij_1"},F=({})=>{const{sendMessage:r}=g(s=>({sendMessage:s.sendMessage})),[a,l]=h.useState(""),n=()=>{r(a),l("")};return t.jsxs("div",{className:B["controll-block"],children:[t.jsx(w,{value:a,onChange:s=>l(s.target.value)}),t.jsx(D,{text:"отправить",onClick:n})]})},R=()=>{const r=g(e=>e.sendFile),[a,l]=h.useState([]),[n,s]=h.useState(!1),m=e=>{e.preventDefault(),e.target.files&&e.target.files[0]&&l([e.target.files[0]])},u=()=>{l([])},c=async e=>{if(e.preventDefault(),!a||a.length===0)return;const i=await a[0].arrayBuffer(),o=new Uint8Array(i);r(o)},_=function(e){e.preventDefault(),s(!0)},f=function(e){e.preventDefault(),s(!1)},d=function(e){var i;e.preventDefault(),s(!1),(i=e.dataTransfer)!=null&&i.files&&e.dataTransfer.files[0]&&l([e.dataTransfer.files[0]])};return t.jsx("div",{className:x(p.wrapper,{[p.drag]:n}),children:t.jsxs("form",{className:x(p.form),onReset:u,onSubmit:c,onDragEnter:_,onDragOver:_,onDragLeave:f,onDrop:d,children:[t.jsx("h2",{className:p["action-title"],children:"Перетащите файлы сюда"}),t.jsx("p",{children:"или"}),t.jsxs("label",{className:p.label,children:[t.jsx("span",{className:p["download-label"],children:"Загрузите файл"}),t.jsx("input",{className:p.input,type:"file",multiple:!1,onChange:m})]}),a.length>0&&t.jsxs("div",{className:p.info,children:[t.jsx("ul",{className:p["file-list"],children:t.jsx("li",{children:a[0].name})}),t.jsxs("div",{className:p.btns,children:[t.jsx("button",{className:p["button-reset"],type:"reset",children:"Отменить"}),t.jsx("button",{className:p["button-submit"],type:"submit",children:"Отправить"})]})]})]})})};function A(r){const[a,l]=h.useState([r]),[n,s]=h.useState(0),[m,u]=h.useState(""),c=a[a.length-1];h.useEffect(()=>{const d=e=>{if(document.activeElement&&document.activeElement.tagName==="INPUT")return;const i=c.items.length;if(i!==0){if(e.key==="ArrowUp")e.preventDefault(),s(o=>o>0?o-1:i-1);else if(e.key==="ArrowDown")e.preventDefault(),s(o=>o<i-1?o+1:0);else if(e.key==="Home")e.preventDefault(),s(0);else if(e.key==="End")e.preventDefault(),s(i-1);else if(e.key==="Enter"){e.preventDefault();const o=c.items[n];if(!o||o.disabled)return;o.children?(l(j=>[...j,{title:o.label,items:o.children}]),s(0)):o.action&&o.action()}else if(e.key==="Backspace"||e.key==="Escape")e.preventDefault(),l(o=>o.length>1?o.slice(0,-1):o),s(0);else if(/^[0-9]$/.test(e.key)){const o=parseInt(e.key,10)-1;o>=0&&o<i&&s(o)}}};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[c,n]);const _=d=>{const e=d-1;if(e>=0&&e<c.items.length){s(e);const i=c.items[e];if(!i||i.disabled)return;i.children?(l(o=>[...o,{title:i.label,items:i.children}]),s(0)):i.action&&i.action()}};return{stack:a,currentMenu:c,selectedIndex:n,inputValue:m,setInputValue:u,setSelectedIndex:s,submitInput:d=>{const e=parseInt(d,10);isNaN(e)||_(e)}}}const U="_container_1n1fe_1",V="_breadcrumbs_1n1fe_17",W="_items_1n1fe_31",L="_item_1n1fe_31",T="_active_1n1fe_73",O="_disabled_1n1fe_87",q="_index_1n1fe_95",P="_label_1n1fe_107",z="_arrow_1n1fe_117",H="_inputRow_1n1fe_127",K="_prompt_1n1fe_139",Y="_help_1n1fe_187",b={container:U,breadcrumbs:V,items:W,item:L,active:T,disabled:O,index:q,label:P,arrow:z,inputRow:H,prompt:K,help:Y},G={title:"Главное меню",items:[{label:"Файлы",children:[{label:"Создать",action:()=>console.log("Создать файл")},{label:"Открыть",action:()=>console.log("Открыть файл")},{label:"Удалить",action:()=>console.log("Удалить файл")}]},{label:"Настройки",children:[{label:"Профиль",action:()=>console.log("Профиль")},{label:"Система",action:()=>console.log("Система")}]},{label:"Выход",action:()=>console.log("Выход")}]},J=({menu:r})=>{const{stack:a,currentMenu:l,selectedIndex:n,inputValue:s,setInputValue:m,setSelectedIndex:u,submitInput:c}=A(r);if(!l)return null;const _=f=>{f.preventDefault(),c(s),m("")};return t.jsxs("div",{className:b.container,children:[t.jsx("div",{className:b.breadcrumbs,children:"> "+a.map(f=>f.title).join(" / ")}),t.jsx("div",{className:b.items,children:l.items.map((f,d)=>{const e=d===n;return t.jsxs("div",{className:[b.item,e?b.active:"",f.disabled?b.disabled:""].join(" "),onMouseDown:i=>{i.preventDefault(),u(d)},children:[t.jsxs("span",{className:b.index,children:[d+1,"."]}),t.jsx("span",{className:b.label,children:f.label}),f.children&&t.jsx("span",{className:b.arrow,children:"›"})]},d)})}),t.jsxs("form",{onSubmit:_,className:b.inputRow,children:[t.jsx("span",{className:b.prompt,children:">"}),t.jsx(w,{value:s,onChange:f=>m(f.target.value),placeholder:"Введите номер пункта...","aria-label":"Выбор пункта по номеру"})]}),t.jsx("div",{className:b.help,children:"↑↓ выбрать • Enter открыть/выполнить • Backspace/Esc назад • [цифра] быстрый выбор • введите номер и Enter"})]})},Q=({menu:r})=>{const a=h.useMemo(()=>r??G,[r]);return t.jsx(J,{menu:a})},X="_row_q0ihq_1",Z={row:X},oe=()=>{const[r,a,l,n,s]=g(u=>[u.status,u.error,u.messages,u.connect,u.disconnect],k),m={title:"Главное меню",items:[{label:"Файлы",children:[{label:"Создать",action:()=>console.log("Создать файл")},{label:"Открыть",action:()=>console.log("Открыть файл")},{label:"Удалить",action:()=>console.log("Удалить файл")}]},{label:"Настройки",children:[{label:"Профиль",action:()=>console.log("Профиль")},{label:"Система",action:()=>console.log("Система")}]},{label:"Выход",action:()=>console.log("Выход")}]};return t.jsxs("div",{children:[t.jsx("h2",{children:"WebSocket"}),t.jsxs("p",{children:["Status: ",r," ",a&&`| Error: ${a}`]}),t.jsx("button",{onClick:()=>n("wss://int-rt.ru:3010"),children:"Подключить"}),t.jsx("br",{}),t.jsx("button",{onClick:s,children:"Отключить"}),t.jsx("div",{style:{height:"300px",overflowY:"auto",border:"1px solid blue",padding:"10px",marginTop:"10px"},children:l.map((u,c)=>t.jsx("p",{children:u},c))}),t.jsx(F,{}),t.jsxs("div",{className:Z.row,children:[t.jsx(Q,{menu:m}),t.jsx(R,{})]})]})};export{oe as default};
