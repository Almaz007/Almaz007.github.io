import{r as R,j as a}from"./index-5v0WUSE6.js";import{g as L,e as B,u as q,S as K,s as X,C as Y,a as _,n as z,p as A,G as J}from"./GraphPanel-CzT29w7d.js";import{b as F,a as H,g as M,R as Q,i as U,B as W,C as Z}from"./store2-B2nLEZdA.js";import"./store-CHJ044RD.js";import"./store-CzlH7EyP.js";import"./store-DWPSX4g-.js";import"./store-CXWocZK6.js";import"./helpers-fab74NUc.js";import"./store-DMyAk-zp.js";import"./store-D1k0Q38A.js";import{s as I}from"./shallow-BbWNg5yE.js";import"./Button-DkAy4TqJ.js";import"./Input-C2xJGQu9.js";import"./CustomSelect-Cj4OeTpF.js";const $=()=>{const d=F(t=>t.addNode,I),{screenToFlowPosition:l}=H();return{onDragOver:R.useCallback(t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},[]),onDrop:t=>{t.preventDefault();const u=t.dataTransfer.getData("application/reactflow"),f=l({x:t.clientX,y:t.clientY}),i=L(u,f);i&&d(i)}}},tt=()=>{const{nodes:d,edges:l,onNodesChange:D,onEdgesChange:E,addEdge:t}=F(B,I),{onDragOver:u,onDrop:f}=$(),{getNodes:i,getEdges:k}=H(),{enqueueSnackbar:P}=q();return{nodes:d,edges:l,onNodesChange:D,onEdgesChange:E,addEdge:t,onDragOver:u,onDrop:f,isValidConnection:g=>{var w,b,h,T;const m=i(),j=k(),n=g.source??"",C=g.target??"",e=g.sourceHandle,s=g.targetHandle,c=m.find(o=>o.id===n),r=m.find(o=>o.id===C);if(!c||!r||!e||!s)return!1;const N=((w=c.data.outputHandles[e==null?void 0:e.split(" ")[1]])==null?void 0:w.dataType)||((b=c.data.inputHandles[e==null?void 0:e.split(" ")[1]])==null?void 0:b.dataType),S=((h=r.data.inputHandles[s==null?void 0:s.split(" ")[1]])==null?void 0:h.dataType)||((T=r.data.outputHandles[s==null?void 0:s.split(" ")[1]])==null?void 0:T.dataType);if(N!==S)return!1;const y=(o,p=new Set)=>{if(p.has(o.id))return!1;p.add(o.id);for(const x of M(o,m,j))if(x.id===n||y(x,p))return!0;return!1};return n===C?!1:!y(r)},onConnectEnd:(g,m)=>{var h,T,o,p,x,v,G,V;const{fromNode:j,fromHandle:n,toNode:C,toHandle:e,isValid:s}=m,c=O=>O==null?void 0:O.data;if(!j||!C||!(n!=null&&n.id)||!(e!=null&&e.id))return;const r=n.id.split(" ")[1],N=e.id.split(" ")[1],S=c(j),y=c(C),w=((T=(h=S.outputHandles)==null?void 0:h[r])==null?void 0:T.dataType)??((p=(o=S.inputHandles)==null?void 0:o[r])==null?void 0:p.dataType),b=((v=(x=y.inputHandles)==null?void 0:x[N])==null?void 0:v.dataType)??((V=(G=y.outputHandles)==null?void 0:G[N])==null?void 0:V.dataType);w!==b&&s===!1&&P("Нерроектное соединение",{variant:"error"})}}},et=()=>{const{nodes:d,edges:l,onNodesChange:D,onEdgesChange:E,onDragOver:t,onDrop:u,isValidConnection:f,onConnectEnd:i,addEdge:k}=tt();return a.jsx("div",{className:X["graph-editor"],children:a.jsxs(U,{deleteKeyCode:null,proOptions:A,nodeTypes:z,edgeTypes:_,nodes:d,edges:l,onNodesChange:D,onEdgesChange:E,onConnect:k,onDragOver:t,onDrop:u,connectionLineComponent:Y,isValidConnection:f,onConnectEnd:i,fitView:!0,children:[a.jsx(J,{nodes:d}),a.jsx(W,{}),a.jsx(Z,{})]})})},ot=()=>a.jsx(Q,{children:a.jsx(K,{maxSnack:3,children:a.jsx(et,{})})}),Tt=()=>a.jsx(ot,{});export{Tt as default};
