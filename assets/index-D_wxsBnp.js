import{r as m,j as s}from"./index-B7-Tk3ta.js";import{B as y}from"./Button-wNmzC7v4.js";import{I}from"./Input-DAcSBmaA.js";import{T as k}from"./Table-BDS45m1G.js";import{M as R}from"./Modal-q8PRq-Ca.js";import{n as P}from"./index-CzkVACPK.js";import{u as F}from"./store-DXjMZVp6.js";import{g as D}from"./helpers-C0jkC3_s.js";import{C as B}from"./CheckBox-C4G_FJn6.js";import{s as W}from"./shallow-3eT9xt5d.js";import"./v4-C6aID195.js";const K=({id:h,value:N})=>{const[x,b]=P(i=>[i.nodes,i.updateNodes]),n=m.useMemo(()=>x.find(i=>i.id===h),[x]);if(!n)return s.jsx("div",{children:"узел не найден"});const d=i=>{const u={...n,data:{...n==null?void 0:n.data,name:i}},j=x.map(_=>_.id===u.id?u:_);b(j)};return s.jsx(I,{value:N,onChange:i=>d(i.target.value)})},O={led1:0,led2:0,led3:0,blOn:0,blOff:0,sms:0,smsWeb:0},E=["id","name"],V=()=>{const{smsText:h,setSms:N,smsWebText:x,setSmsWeb:b,indications:n,setIndications:d,phoneNumber:i,setPhoneNumber:u}=F(e=>({indications:e.indications,setIndications:e.setIndications,smsText:e.smsText,setSms:e.setSms,smsWebText:e.smsWebText,setSmsWeb:e.setSmsWeb,phoneNumber:e.phoneNumber,setPhoneNumber:e.setPhoneNumber}),W),j=P(e=>e.nodes,W);m.useEffect(()=>{const t=j.filter(o=>{var a,g;return(g=(a=o==null?void 0:o.data)==null?void 0:a.type)==null?void 0:g.toLowerCase().includes("output")}).reduce((o,a)=>(o[a.id]={...n[a.id]??O,id:a.id,name:a.data.name??""},o),{});d(t)},[j]);const _=m.useMemo(()=>Object.values(n),[n]),v=(e,t)=>{const o=n[e],a=Object.entries(n).find(([g,w])=>w[t]===1);a&&a[0]!==e||d({...n,[e]:{...o,[t]:o[t]?0:1}})},l=(e,t)=>{E.includes(t)||v(e,t)},f=m.useMemo(()=>D({id:"",name:"",...O}),[]);return{renderHead:()=>f.map(e=>s.jsx("th",{children:e},e)),renderRow:e=>s.jsx(s.Fragment,{children:f.map(t=>{const o=!E.includes(t);return s.jsx("td",{style:{cursor:o?"pointer":"default"},children:t==="name"?s.jsx(K,{value:e.name,id:e.id}):o?s.jsx(B,{checked:!!e[t],onChange:()=>l(e.id,t)}):e[t]},t)})}),rows:_,smsText:h,setSms:N,smsWebText:x,setSmsWeb:b,phoneNumber:i,setPhoneNumber:u}},A="_content_y9eit_11",H="_title_y9eit_17",c={"btns-row":"_btns-row_y9eit_1",content:A,title:H,"controlled-block":"_controlled-block_y9eit_23","input-row":"_input-row_y9eit_35","input-label":"_input-label_y9eit_43","error-text":"_error-text_y9eit_53"},M=h=>/^\+?\d{10,15}$/.test(h),L=()=>{const{renderHead:h,renderRow:N,rows:x,smsText:b,setSms:n,smsWebText:d,setSmsWeb:i,phoneNumber:u,setPhoneNumber:j}=V(),[_,v]=m.useState(!1),[l,f]=m.useState("sms"),[p,C]=m.useState({sms:{title:"СМС",value:b},smsWeb:{title:"udp СМС",value:d},phoneNumber:u}),[e,t]=m.useState(!0);m.useEffect(()=>{C({sms:{title:"СМС",value:b},smsWeb:{title:"СМС UDP",value:d},phoneNumber:u})},[b,d,u]);const o=(r,S)=>{C(T=>({...T,[r]:{...T[r],value:S}}))},a=r=>{C(S=>({...S,phoneNumber:r})),t(M(r))},g=()=>{const{value:r}=p[l],S=p.phoneNumber;l==="sms"?(n(r),j(S)):i(r),v(!1)},w=l==="sms"&&!M(p.phoneNumber);return s.jsxs("div",{children:[s.jsx(k,{renderRow:N,renderHead:h,rowItems:x,getRowKey:r=>r.id,maxWidth:1100}),s.jsxs("div",{className:c["btns-row"],children:[s.jsx(y,{text:"смс",onClick:()=>{v(!0),f("sms")}}),s.jsx(y,{text:"смс udp",onClick:()=>{v(!0),f("smsWeb")}})]}),s.jsx(R,{visible:_,setVisible:v,children:s.jsxs("div",{className:c.content,children:[s.jsx("h2",{className:c.title,children:p[l].title}),s.jsxs("div",{className:c["controlled-block"],children:[s.jsxs("div",{className:c["input-row"],children:[s.jsx("label",{className:c["input-label"],children:"Сообщение"}),s.jsx(I,{value:p[l].value,onChange:r=>o(l,r.target.value)})]}),l==="sms"&&s.jsxs("div",{className:c["input-row"],children:[s.jsx("label",{className:c["input-label"],children:"Номер телефона:"}),s.jsx(I,{value:p.phoneNumber,onChange:r=>a(r.target.value),style:{borderColor:e?void 0:"red"}}),!e&&s.jsx("span",{className:c["error-text"],children:"Неверный номер телефона"})]}),s.jsx(y,{text:"Сохранить",onClick:g,disabled:w})]})]})})]})},se=()=>s.jsx(L,{});export{se as default};
