import{r as N,j as e,c as v}from"./index-DG_wumhX.js";import{u as S}from"./store-72EAVomj.js";import{d as z}from"./helpers-fab74NUc.js";import{c as k,s as C}from"./shallow-Czitllv-.js";import{B as T}from"./Button-CoKw273C.js";import{u as O}from"./store-v8uI5vK9.js";import{u as A}from"./store-tLVg6nTl.js";const $="_wrapper_zxo5y_1",B="_form_zxo5y_17",E="_drag_zxo5y_29",L="_label_zxo5y_43",U="_input_zxo5y_49",W="_info_zxo5y_93",M="_btns_zxo5y_103",d={wrapper:$,form:B,drag:E,"action-title":"_action-title_zxo5y_35",label:L,input:U,"file-list":"_file-list_zxo5y_63","download-label":"_download-label_zxo5y_73",info:W,btns:M,"button-reset":"_button-reset_zxo5y_111","button-submit":"_button-submit_zxo5y_113","dnd-tile":"_dnd-tile_zxo5y_135"},F=({handleSubmit:r,title:u})=>{const[o,s]=N.useState([]),[c,a]=N.useState(!1),l=t=>{t.preventDefault(),t.target.files&&t.target.files[0]&&s([t.target.files[0]])},m=()=>{s([])},p=function(t){t.preventDefault(),a(!0)},f=function(t){t.preventDefault(),a(!1)},h=function(t){var g;t.preventDefault(),a(!1),(g=t.dataTransfer)!=null&&g.files&&t.dataTransfer.files[0]&&s([t.dataTransfer.files[0]])};return e.jsxs("div",{className:v(d.wrapper,{[d.drag]:c}),children:[e.jsx("h2",{className:d["dnd-tile"],children:u}),e.jsxs("form",{className:v(d.form),onReset:m,onDragEnter:p,onDragOver:p,onDragLeave:f,onDrop:h,children:[e.jsx("h2",{className:d["action-title"],children:"Перетащите файлы сюда"}),e.jsx("p",{children:"или"}),e.jsxs("label",{className:d.label,children:[e.jsx("span",{className:d["download-label"],children:"Загрузите файл"}),e.jsx("input",{className:d.input,type:"file",multiple:!1,onChange:l})]}),o.length>0&&e.jsxs("div",{className:d.info,children:[e.jsx("ul",{className:d["file-list"],children:e.jsx("li",{children:o[0].name})}),e.jsxs("div",{className:d.btns,children:[e.jsx("button",{className:d["button-reset"],type:"reset",children:"Отменить"}),e.jsx("button",{className:d["button-submit"],onClick:t=>r(t,o),children:"Отправить"})]})]})]})]})},P=k((r,u)=>({ws:null,status:"disconnected",error:null,messages:[],strForDownload:[],clearMessages:()=>{r({messages:[]})},parseOscilografFile:async o=>{const{strForDownload:s}=u(),c=await o.arrayBuffer(),a=new DataView(c),l={};for(let f=0;f+16<=a.byteLength;f+=16){const h=a.getUint32(f,!0);if(h===0)return;const t=a.getUint32(f+4,!0),g=a.getUint32(f+8,!0),w=a.getUint32(f+12,!0),_=`номер: ${h}, метка: ${t}, смещение: ${g}, значение: ${w}`;s.push(_),l[g]||(l[g]={timePoints:[],values:[]}),l[g].timePoints.push(t),l[g].values.push(w)}s.push(`endPart

`),r({strForDownload:s});const m=S.getState();console.log(a);const p=a.byteLength!==1344;if(p){const t=`dataLogicAnalyzer_${new Date().toISOString().replace("T","_").replace(/:/g,"-").split(".")[0]}.txt`;z(s.join(`
`),t,"text/plain"),r({strForDownload:[]})}m.updateOscillographicData(l,p)},downloadStr:()=>{const{strForDownload:o}=u(),a=`dataLogicAnalyzer_${new Date().toISOString().replace("T","_").replace(/:/g,"-").split(".")[0]}.txt`;z(o.join(`
`),a,"text/plain"),S.getState().clearTempOscillographic()},connect:o=>{let{ws:s,parseOscilografFile:c,status:a}=u();s||(r({status:"connecting",error:null}),s=new WebSocket(o),r({ws:s}),s.onopen=()=>{r({error:null,status:"connected"}),console.log("WebSocket connected")},s.onmessage=async l=>{l.data instanceof Blob?(r(m=>({messages:[...m.messages,`Получен бинарный пакет ${m.messages.length+1}`]})),await c(l.data)):(console.log("Получено с сервера:",l.data),r(m=>({messages:[...m.messages,l.data.toString()]})))},s.onerror=()=>{r({error:"Connection error",status:"disconnected"})},s.onclose=()=>{console.log("WebSocket closed. Status was:",a),s=null,r({ws:null,status:"disconnected"})})},disconnect:()=>{const{ws:o}=u();o&&(o.close(),r({ws:null,status:"disconnected"}))},sendMessage:o=>{const{ws:s}=u();s&&(r(c=>({messages:[...c.messages,o]})),s.send(o))},sendFile:o=>{const{ws:s}=u();s&&(r(c=>({messages:[...c.messages,"Файл отправлен"]})),s.send(o))},sendConfig:o=>{const{ws:s}=u();s&&(r(c=>({messages:[...c.messages,"Конфиг отправлен"]})),s.send(o))}})),R="_row_5hypj_1",b={row:R,"action-btn":"_action-btn_5hypj_11","actions-memory":"_actions-memory_5hypj_29"},K=()=>{const r=A(n=>n.sendFirmware),u=S(n=>n.clearTempOscillographic),[o,s,c,a,l,m,p,f,h]=P(n=>[n.status,n.error,n.messages,n.connect,n.disconnect,n.sendConfig,n.sendFile,n.clearMessages,n.downloadStr],C),t=O(n=>n.config,C),g=()=>{const n=new TextEncoder().encode(JSON.stringify(t));if(n.length===0){console.log("конфиг не отправлен");return}const i=new TextEncoder().encode("flexibleLogic,"),x=new Uint8Array(i.length+n.length);x.set(i,0),x.set(n,i.length),m(x)},w=async(n,i)=>{if(n.preventDefault(),!i||i.length===0)return;const x=await i[0].arrayBuffer(),D=new Uint8Array(x),j=new TextEncoder().encode("firmware,"),y=new Uint8Array(j.length+D.length);y.set(j,0),y.set(D,j.length),p(y)},_=async(n,i)=>{if(n.preventDefault(),!i||i.length===0)return;const x=await i[0].arrayBuffer();r(x)};return e.jsxs("div",{children:[e.jsx("h2",{children:"WebSocket"}),e.jsxs("p",{children:["Status: ",o," ",s&&`| Error: ${s}`]}),e.jsx("br",{}),e.jsx("button",{className:b["action-btn"],onClick:()=>a("wss://int-rt.ru:3010"),children:"Подключить"}),e.jsx("br",{}),e.jsx("button",{className:b["action-btn"],onClick:l,children:"Отключить"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{className:b["actions-memory"],children:[e.jsx("button",{className:b["action-btn"],onClick:u,children:"Очистить временную память"}),e.jsx("br",{}),e.jsx("button",{className:b["action-btn"],onClick:f,children:"Очистить логи"}),e.jsx("button",{className:b["action-btn"],onClick:h,children:"Скачать данные из временной памяти"})]}),e.jsx("div",{style:{height:"300px",overflowY:"auto",border:"1px solid blue",padding:"10px",marginTop:"10px"},children:c.map((n,i)=>e.jsx("p",{children:n},i))}),e.jsx("br",{}),e.jsxs("div",{className:b.row,children:[e.jsx(F,{handleSubmit:w,title:"Отправка прошивки по web-socket"}),e.jsx(F,{handleSubmit:_,title:"Отправка прошивки по ble"}),e.jsxs("div",{children:[e.jsx(T,{disabled:!t.scripts.length,onClick:g,text:"загрузить"}),e.jsx("br",{}),!t.scripts.length&&e.jsx("div",{children:"необходимо сформировать гибкую логику"})]})]})]})};export{K as default};
