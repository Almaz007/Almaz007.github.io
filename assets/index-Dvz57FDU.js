import{r as x,u as g,b as y,j as t,m as w}from"./index-Cbj21JmJ.js";import{T as M}from"./Table-WpjJJ0XE.js";import{I as S}from"./Input-BiIIJ4QV.js";import{C as F}from"./CustomSelect-BjOyUkkV.js";import{i as V,a as T}from"./validators-C1iEiny_.js";import{s as b}from"./shallow-BHpKla55.js";const v=(n,s,d)=>{if(!("setpointDataType"in s)||s.type!=="fourierInt")return;const[l,p]=x.useState([...s.setpointValue]),o=x.useCallback(i=>{d(n,{setpointValue:i})},[n,d]);return{inputsValue:l,handleFourierGarmonicForOutput:(i,f)=>{if(V(f)){const e=Number(f);if(!Number.isNaN(e)&&e>=0&&e<=19){const r=[...l];r[i]=e,o([...r]),p([...r])}}}}},k=(n,s,d)=>{if(!("setpointDataType"in s)||Array.isArray(s.setpointValue))return;const{setpointDataType:l}=s,[p,o]=x.useState(String(s.setpointValue)),a=x.useCallback(e=>{d(n,{setpointValue:e})},[n,d]),i=(e,r)=>{if(e===""||e==="-"||e==="."||e==="-.")return e;r&&(e=e.replace(",","."));const m=Number(e);return Number.isNaN(m)?e:String(m)};return{handleChange:e=>{let r=e.target.value;switch(l){case"int":if(V(r)){const u=i(r,!1);o(u);const h=Number(u);Number.isNaN(h)||a(h)}break;case"float":if(T(r)){const u=i(r,!0);o(u);const h=Number(u);Number.isNaN(h)||a(h)}break;case"bool":const N=e.target.checked?1:0;a(N),o(String(N));break}},inputValue:p}},O=({id:n,value:s})=>{const{nodes:d,updateNodes:l}=g(e=>({nodes:e.nodes,updateNodes:e.updateNodes}),b),{nodes2:p,updateNodes2:o}=y(e=>({nodes2:e.nodes,updateNodes2:e.updateNodes}),b),a=x.useMemo(()=>d.find(e=>e.id===n),[d]),i=x.useMemo(()=>p.find(e=>e.id===n),[p]);if(!a&&!i)return t.jsx("div",{children:"узел не найден"});const f=a?e=>{const r={...a,data:{...a==null?void 0:a.data,name:e}},m=d.map(N=>N.id===r.id?r:N);l(m)}:i?e=>{const r={...i,data:{...i==null?void 0:i.data,name:e}},m=p.map(N=>N.id===r.id?r:N);o(m)}:()=>{};return t.jsx(S,{value:s,onChange:e=>f(e.target.value)})},R=({id:n,data:s})=>{const{setNodeData1:d,nodes:l}=g(u=>({setNodeData1:u.setNodeData,nodes:u.nodes}),b),{setNodeData2:p,nodes2:o}=y(u=>({setNodeData2:u.setNodeData,nodes2:u.nodes}),b),{type:a,name:i}=s,f=[{label:"кВ",value:"кВ"},{label:"В",value:"В"},{label:"А",value:"А"},{label:"N",value:"N"}],e=l.find(u=>u.id===n)?d:o.find(u=>u.id===n)?p:()=>({}),r=k(n,s,e);if(!r)return t.jsx(t.Fragment,{});const{handleChange:m,inputValue:N}=r;return t.jsxs(t.Fragment,{children:[t.jsx("td",{children:n},0),t.jsx("td",{children:a},1),t.jsx("td",{children:t.jsx(O,{value:i??"",id:n})},2),t.jsx("td",{children:t.jsx(S,{type:"text",value:N,onChange:m})},3),t.jsx("td",{children:t.jsx(F,{options:f,value:s.unitOfMeasure?s.unitOfMeasure:"",onChange:u=>{e(n,{unitOfMeasure:u})},placeholder:"Ед. измерения"})},4)]})},E=({id:n,data:s})=>{const{setNodeData1:d,nodes:l}=g(c=>({setNodeData1:c.setNodeData,nodes:c.nodes})),{setNodeData2:p,nodes2:o}=y(c=>({setNodeData2:c.setNodeData,nodes2:c.nodes})),a=[{label:"N",value:"N"}],i=l.find(c=>c.id===n)?d:o.find(c=>c.id===n)?p:()=>({}),{type:f,name:e,outputHandles:r}=s,m=v(n,s,i);if(!m)return t.jsx(t.Fragment,{});const{handleFourierGarmonicForOutput:N,inputsValue:u}=m,h=Object.values(r).reduce((c,j,D)=>(D%2===0?c.push([j]):c[c.length-1].push(j),c),[]);return t.jsxs(t.Fragment,{children:[t.jsx("td",{children:n},0),t.jsx("td",{children:f},1),t.jsx("td",{children:t.jsx(O,{value:e??"",id:n})},2),t.jsx("td",{style:{display:"flex",gap:"10px"},children:h.map((c,j)=>t.jsx(S,{style:{width:"60px"},type:"number",value:u[j],onChange:D=>N(j,D.target.value)},j))},3),t.jsx("td",{children:t.jsx(F,{options:a,value:s.unitOfMeasure?s.unitOfMeasure:"",onChange:c=>{i(n,{unitOfMeasure:c})},placeholder:"Ед. измерения"})},4)]})},C={id:"",type:"Тип",name:"Название",value:"Значение",unitOfMeasure:"Единица измерения"};function I(n){return"setpointDataType"in n.data}const H=()=>{const n=g(o=>o.nodes,b),s=y(o=>o.nodes,b),d=x.useMemo(()=>[...n,...s].filter(a=>I(a)).map(a=>({id:a.id,data:a.data})),[n,s]);return{renderHead:()=>t.jsx(t.Fragment,{children:w(C).map(o=>t.jsx("th",{children:C[o]},o))}),rows:d,renderRow:o=>o.data.type==="fourierInt"?t.jsx(E,{id:o.id,data:o.data}):t.jsx(R,{id:o.id,data:o.data})}},A=({})=>{const{renderHead:n,rows:s,renderRow:d}=H();return t.jsx("div",{children:t.jsx(M,{rowItems:s,renderHead:n,renderRow:d,getRowKey:l=>l.id,maxWidth:1e3})})},W=()=>t.jsx("div",{children:t.jsx(A,{})});export{W as default};
