import{r as h,j as s}from"./index-C_4yp_nz.js";import{B as I}from"./Button-B019Eqjp.js";import{I as T}from"./Input-C16kTWuA.js";import{T as R}from"./Table-CZKWmZGe.js";import{M as F}from"./Modal-DtnKUgIC.js";import{u as P,b as k}from"./store2-CD7zKPG9.js";import{u as D}from"./store-DHHy1zlU.js";import{g as B}from"./helpers-fab74NUc.js";import{C as K}from"./CheckBox-L0TIJleK.js";import{s as w}from"./shallow-CDFTM4LJ.js";const V=({id:p,value:v})=>{const{nodes:j,updateNodes:_}=P(t=>({nodes:t.nodes,updateNodes:t.updateNodes}),w),{nodes2:i,updateNodes2:N}=k(t=>({nodes2:t.nodes,updateNodes2:t.updateNodes}),w),m=h.useMemo(()=>j.find(t=>t.id===p),[j]),d=h.useMemo(()=>i.find(t=>t.id===p),[i]);if(!m&&!d)return s.jsx("div",{children:"узел не найден"});const f=m?t=>{const c={...m,data:{...m==null?void 0:m.data,name:t}},a=j.map(u=>u.id===c.id?c:u);_(a)}:d?t=>{const c={...d,data:{...d==null?void 0:d.data,name:t}},a=i.map(u=>u.id===c.id?c:u);N(a)}:()=>{};return s.jsx(T,{value:v,onChange:t=>f(t.target.value)})},E={led1:0,led2:0,led3:0,blOn:0,blOff:0,sms:0,smsWeb:0},M=["id","name"],A=()=>{const{smsText:p,setSms:v,smsWebText:j,setSmsWeb:_,indications:i,setIndications:N,phoneNumber:m,setPhoneNumber:d}=D(e=>({indications:e.indications,setIndications:e.setIndications,smsText:e.smsText,setSms:e.setSms,smsWebText:e.smsWebText,setSmsWeb:e.setSmsWeb,phoneNumber:e.phoneNumber,setPhoneNumber:e.setPhoneNumber}),w),f=P(e=>e.nodes,w),t=k(e=>e.nodes,w);h.useEffect(()=>{const n=[...f,...t].filter(r=>{var l,S;return(S=(l=r==null?void 0:r.data)==null?void 0:l.type)==null?void 0:S.toLowerCase().includes("output")}).reduce((r,l)=>(r[l.id]={...i[l.id]??E,id:l.id,name:l.data.name??""},r),{});N(n)},[f]);const c=h.useMemo(()=>Object.values(i),[i]),a=(e,n)=>{const r=i[e],l=Object.entries(i).find(([S,o])=>o[n]===1);l&&l[0]!==e||N({...i,[e]:{...r,[n]:r[n]?0:1}})},u=(e,n)=>{M.includes(n)||a(e,n)},x=h.useMemo(()=>B({id:"",name:"",...E}),[]);return{renderHead:()=>x.map(e=>s.jsx("th",{children:e},e)),renderRow:e=>s.jsx(s.Fragment,{children:x.map(n=>{const r=!M.includes(n);return s.jsx("td",{style:{cursor:r?"pointer":"default"},children:n==="name"?s.jsx(V,{value:e.name,id:e.id}):r?s.jsx(K,{checked:!!e[n],onChange:()=>u(e.id,n)}):e[n]},n)})}),rows:c,smsText:p,setSms:v,smsWebText:j,setSmsWeb:_,phoneNumber:m,setPhoneNumber:d}},H="_content_y9eit_11",L="_title_y9eit_17",b={"btns-row":"_btns-row_y9eit_1",content:H,title:L,"controlled-block":"_controlled-block_y9eit_23","input-row":"_input-row_y9eit_35","input-label":"_input-label_y9eit_43","error-text":"_error-text_y9eit_53"},O=p=>/^\+?\d{10,15}$/.test(p),U=()=>{const{renderHead:p,renderRow:v,rows:j,smsText:_,setSms:i,smsWebText:N,setSmsWeb:m,phoneNumber:d,setPhoneNumber:f}=A(),[t,c]=h.useState(!1),[a,u]=h.useState("sms"),[x,C]=h.useState({sms:{title:"СМС",value:_},smsWeb:{title:"udp СМС",value:N},phoneNumber:d}),[y,e]=h.useState(!0);h.useEffect(()=>{C({sms:{title:"СМС",value:_},smsWeb:{title:"СМС UDP",value:N},phoneNumber:d})},[_,N,d]);const n=(o,g)=>{C(W=>({...W,[o]:{...W[o],value:g}}))},r=o=>{C(g=>({...g,phoneNumber:o})),e(O(o))},l=()=>{const{value:o}=x[a],g=x.phoneNumber;a==="sms"?(i(o),f(g)):m(o),c(!1)},S=a==="sms"&&!O(x.phoneNumber);return s.jsxs("div",{children:[s.jsx(R,{renderRow:v,renderHead:p,rowItems:j,getRowKey:o=>o.id,maxWidth:1100}),s.jsxs("div",{className:b["btns-row"],children:[s.jsx(I,{text:"смс",onClick:()=>{c(!0),u("sms")}}),s.jsx(I,{text:"смс udp",onClick:()=>{c(!0),u("smsWeb")}})]}),s.jsx(F,{visible:t,setVisible:c,children:s.jsxs("div",{className:b.content,children:[s.jsx("h2",{className:b.title,children:x[a].title}),s.jsxs("div",{className:b["controlled-block"],children:[s.jsxs("div",{className:b["input-row"],children:[s.jsx("label",{className:b["input-label"],children:"Сообщение"}),s.jsx(T,{value:x[a].value,onChange:o=>n(a,o.target.value)})]}),a==="sms"&&s.jsxs("div",{className:b["input-row"],children:[s.jsx("label",{className:b["input-label"],children:"Номер телефона:"}),s.jsx(T,{value:x.phoneNumber,onChange:o=>r(o.target.value),style:{borderColor:y?void 0:"red"}}),!y&&s.jsx("span",{className:b["error-text"],children:"Неверный номер телефона"})]}),s.jsx(I,{text:"Сохранить",onClick:l,disabled:S})]})]})})]})},se=()=>s.jsx(U,{});export{se as default};
