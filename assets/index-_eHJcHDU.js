import{r as m,j as r}from"./index-DOFFnWtB.js";import{u as p}from"./store-BDJaUdW_.js";import{c as f,s as x}from"./shallow-C-TL3SJ9.js";import{B as h}from"./Button-B2zOoW6b.js";import{I as b}from"./Input-DsXn27fa.js";const u=f((n,a)=>({ws:null,status:"disconnected",error:null,messages:[],parseOscilografFile:async e=>{const s=await e.arrayBuffer(),t=new DataView(s),o={};for(let c=0;c+16<=t.byteLength;c+=16){if(t.getUint32(c,!0)===0)return;const d=t.getUint32(c+4,!0),i=t.getUint32(c+8,!0),g=t.getUint32(c+12,!0);o[i]||(o[i]={timePoints:[],values:[]}),o[i].timePoints.push(d),o[i].values.push(g)}p.getState().updateOscillographicData(o)},connect:e=>{let{ws:s,parseOscilografFile:t,status:o}=a();s||(n({status:"connecting",error:null}),s=new WebSocket(e),n({ws:s}),s.onopen=()=>{n({error:null,status:"connected"}),console.log("WebSocket connected")},s.onmessage=async l=>{l.data instanceof Blob?(n(c=>({messages:[...c.messages,"Получен бинарный пакет"]})),await t(l.data)):(console.log("Получено с сервера:",l.data),n(c=>({messages:[...c.messages,l.data.toString()]})))},s.onerror=()=>{n({error:"Connection error",status:"disconnected"})},s.onclose=()=>{console.log("WebSocket closed. Status was:",o),s=null,n({ws:null})})},disconnect:()=>{const{ws:e}=a();e&&(e.close(),n({ws:null,status:"disconnected"}))},sendMessage:e=>{const{ws:s}=a();s&&(console.log(e),n(t=>({messages:[...t.messages,e]})),s.send(e))}})),w={"controll-block":"_controll-block_2ueij_1"},j=({})=>{const{sendMessage:n}=u(t=>({sendMessage:t.sendMessage})),[a,e]=m.useState(""),s=()=>{n(a),e("")};return r.jsxs("div",{className:w["controll-block"],children:[r.jsx(b,{value:a,onChange:t=>e(t.target.value)}),r.jsx(h,{text:"отправить",onClick:s})]})},B=()=>{const[n,a,e,s,t]=u(o=>[o.status,o.error,o.messages,o.connect,o.disconnect],x);return r.jsxs("div",{children:[r.jsx("h2",{children:"WebSocket"}),r.jsxs("p",{children:["Status: ",n," ",a&&`| Error: ${a}`]}),r.jsx("button",{onClick:()=>s("wss://int-rt.ru:8081"),children:"Подключить"}),r.jsx("br",{}),r.jsx("button",{onClick:t,children:"Отключить"}),r.jsx("div",{style:{height:"300px",overflowY:"auto",border:"1px solid blue",padding:"10px",marginTop:"10px"},children:e.map((o,l)=>r.jsx("p",{children:o},l))}),r.jsx(j,{})]})};export{B as default};
