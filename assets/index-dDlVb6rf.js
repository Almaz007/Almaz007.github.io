import{r as m,j as s}from"./index-BCwdqR_C.js";import{B as w}from"./Button-DBWDZ7wN.js";import{I}from"./Input-CTczDPDl.js";import{T as y}from"./Table-HtqSzidH.js";import{M as R}from"./Modal-4jWa7dWD.js";import{n as P}from"./index-Bkcxp9y5.js";import{u as F}from"./store-BczLEGFN.js";import{g as D}from"./helpers-C0jkC3_s.js";import{C as B}from"./CheckBox-BWFVIvDX.js";import{s as W}from"./shallow-CqVE0ls7.js";import"./v4-C6aID195.js";const K=({id:h,value:N})=>{const[x,b]=P(a=>[a.nodes,a.updateNodes]),n=m.useMemo(()=>x.find(a=>a.id===h),[x]);if(!n)return s.jsx("div",{children:"узел не найден"});const d=a=>{const u={...n,data:{...n==null?void 0:n.data,name:a}},v=x.map(j=>j.id===u.id?u:j);b(v)};return s.jsx(I,{value:N,onChange:a=>d(a.target.value)})},O={led1:0,led2:0,led3:0,blOn:0,blOff:0,sms:0,smsWeb:0},E=["id","name"],V=()=>{const{smsText:h,setSms:N,smsWebText:x,setSmsWeb:b,indications:n,setIndications:d,phoneNumber:a,setPhoneNumber:u}=F(e=>({indications:e.indications,setIndications:e.setIndications,smsText:e.smsText,setSms:e.setSms,smsWebText:e.smsWebText,setSmsWeb:e.setSmsWeb,phoneNumber:e.phoneNumber,setPhoneNumber:e.setPhoneNumber}),W),v=P(e=>e.nodes,W);m.useEffect(()=>{const t=v.filter(o=>{var i,g;return(g=(i=o==null?void 0:o.data)==null?void 0:i.type)==null?void 0:g.toLowerCase().includes("output")}).reduce((o,i)=>(o[i.id]={...n[i.id]??O,id:i.id,name:i.data.name??""},o),{});d(t)},[v]);const j=m.useMemo(()=>Object.values(n),[n]),_=(e,t)=>{const o=n[e],i=Object.entries(n).find(([g,k])=>k[t]===1);i&&i[0]!==e||d({...n,[e]:{...o,[t]:o[t]?0:1}})},c=(e,t)=>{E.includes(t)||_(e,t)},f=m.useMemo(()=>D({id:"",name:"",...O}),[]);return{renderHead:()=>f.map(e=>s.jsx("th",{children:e},e)),renderRow:e=>s.jsx(s.Fragment,{children:f.map(t=>{const o=!E.includes(t);return s.jsx("td",{style:{cursor:o?"pointer":"default"},children:t==="name"?s.jsx(K,{value:e.name,id:e.id}):o?s.jsx(B,{checked:!!e[t],onChange:()=>c(e.id,t)}):e[t]},t)})}),rows:j,smsText:h,setSms:N,smsWebText:x,setSmsWeb:b,phoneNumber:a,setPhoneNumber:u}},A="_content_avkch_6",H="_title_avkch_9",l={"btns-row":"_btns-row_avkch_1",content:A,title:H,"controlled-block":"_controlled-block_avkch_12","input-row":"_input-row_avkch_18","input-label":"_input-label_avkch_22","error-text":"_error-text_avkch_27"},M=h=>/^\+?\d{10,15}$/.test(h),L=()=>{const{renderHead:h,renderRow:N,rows:x,smsText:b,setSms:n,smsWebText:d,setSmsWeb:a,phoneNumber:u,setPhoneNumber:v}=V(),[j,_]=m.useState(!1),[c,f]=m.useState("sms"),[p,C]=m.useState({sms:{title:"СМС",value:b},smsWeb:{title:"udp СМС",value:d},phoneNumber:u}),[e,t]=m.useState(!0);m.useEffect(()=>{C({sms:{title:"СМС",value:b},smsWeb:{title:"СМС UDP",value:d},phoneNumber:u})},[b,d,u]);const o=(r,S)=>{C(T=>({...T,[r]:{...T[r],value:S}}))},i=r=>{C(S=>({...S,phoneNumber:r})),t(M(r))},g=()=>{const{value:r}=p[c],S=p.phoneNumber;c==="sms"?(n(r),v(S)):a(r),_(!1)},k=c==="sms"&&!M(p.phoneNumber);return s.jsxs("div",{children:[s.jsx(y,{renderRow:N,renderHead:h,rowItems:x,getRowKey:r=>r.id,maxWidth:1100}),s.jsxs("div",{className:l["btns-row"],children:[s.jsx(w,{text:"смс",onClick:()=>{_(!0),f("sms")}}),s.jsx(w,{text:"смс udp",onClick:()=>{_(!0),f("smsWeb")}})]}),s.jsx(R,{visible:j,setVisible:_,children:s.jsxs("div",{className:l.content,children:[s.jsx("h2",{className:l.title,children:p[c].title}),s.jsxs("div",{className:l["controlled-block"],children:[s.jsxs("div",{className:l["input-row"],children:[s.jsx("label",{className:l["input-label"],children:"Сообщение"}),s.jsx(I,{value:p[c].value,onChange:r=>o(c,r.target.value)})]}),c==="sms"&&s.jsxs("div",{className:l["input-row"],children:[s.jsx("label",{className:l["input-label"],children:"Номер телефона:"}),s.jsx(I,{value:p.phoneNumber,onChange:r=>i(r.target.value),style:{borderColor:e?void 0:"red"}}),!e&&s.jsx("span",{className:l["error-text"],children:"Неверный номер телефона"})]}),s.jsx(w,{text:"Сохранить",onClick:g,disabled:k})]})]})})]})},se=()=>s.jsx(L,{});export{se as default};
