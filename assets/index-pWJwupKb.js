import{r as v,j as e,c as x}from"./index-DhmrXgrl.js";import{u as j}from"./store-CkJDDazH.js";import{c as y,s as _}from"./shallow-MFyToQzh.js";import{B as S}from"./Button-AYYAVzf0.js";import{u as D}from"./store-Ee7LXmIk.js";const N="_wrapper_33vv0_1",C="_form_33vv0_9",k="_drag_33vv0_15",E="_label_33vv0_22",F="_input_33vv0_25",A="_info_33vv0_47",T="_btns_33vv0_52",c={wrapper:N,form:C,drag:k,"action-title":"_action-title_33vv0_18",label:E,input:F,"file-list":"_file-list_33vv0_32","download-label":"_download-label_33vv0_37",info:A,btns:T,"button-reset":"_button-reset_33vv0_56","button-submit":"_button-submit_33vv0_57"},w=y((a,l)=>({ws:null,status:"disconnected",error:null,messages:[],parseOscilografFile:async o=>{const s=await o.arrayBuffer(),r=new DataView(s);console.log(s);const d={};for(let i=0;i+16<=r.byteLength;i+=16){const n=r.getUint32(i,!0);if(n===0)return;const g=r.getUint32(i+4,!0),f=r.getUint32(i+8,!0),t=r.getUint32(i+12,!0);console.log(`номер: ${n}, метка: ${g}, смещение: ${f}, значение: ${t}`),d[f]||(d[f]={timePoints:[],values:[]}),d[f].timePoints.push(g),d[f].values.push(t)}j.getState().updateOscillographicData(d)},connect:o=>{let{ws:s,parseOscilografFile:r,status:d}=l();s||(a({status:"connecting",error:null}),s=new WebSocket(o),a({ws:s}),s.onopen=()=>{a({error:null,status:"connected"}),console.log("WebSocket connected")},s.onmessage=async u=>{u.data instanceof Blob?(a(i=>({messages:[...i.messages,"Получен бинарный пакет"]})),await r(u.data)):(console.log("Получено с сервера:",u.data),a(i=>({messages:[...i.messages,u.data.toString()]})))},s.onerror=()=>{a({error:"Connection error",status:"disconnected"})},s.onclose=()=>{console.log("WebSocket closed. Status was:",d),s=null,a({ws:null})})},disconnect:()=>{const{ws:o}=l();o&&(o.close(),a({ws:null,status:"disconnected"}))},sendMessage:o=>{const{ws:s}=l();s&&(a(r=>({messages:[...r.messages,o]})),s.send(o))},sendFile:o=>{const{ws:s}=l();s&&(a(r=>({messages:[...r.messages,"Файл отправлен"]})),s.send(o))},sendConfig:o=>{const{ws:s}=l();s&&(a(r=>({messages:[...r.messages,"Конфиг отправлен"]})),s.send(o))}})),U=()=>{const a=w(t=>t.sendFile),[l,o]=v.useState([]),[s,r]=v.useState(!1),d=t=>{t.preventDefault(),t.target.files&&t.target.files[0]&&o([t.target.files[0]])},u=()=>{o([])},i=async t=>{if(t.preventDefault(),!l||l.length===0)return;const m=await l[0].arrayBuffer(),b=new Uint8Array(m),p=new TextEncoder().encode("firmware,"),h=new Uint8Array(p.length+b.length);h.set(p,0),h.set(b,p.length),a(h)},n=function(t){t.preventDefault(),r(!0)},g=function(t){t.preventDefault(),r(!1)},f=function(t){var m;t.preventDefault(),r(!1),(m=t.dataTransfer)!=null&&m.files&&t.dataTransfer.files[0]&&o([t.dataTransfer.files[0]])};return e.jsx("div",{className:x(c.wrapper,{[c.drag]:s}),children:e.jsxs("form",{className:x(c.form),onReset:u,onSubmit:i,onDragEnter:n,onDragOver:n,onDragLeave:g,onDrop:f,children:[e.jsx("h2",{className:c["action-title"],children:"Перетащите файлы сюда"}),e.jsx("p",{children:"или"}),e.jsxs("label",{className:c.label,children:[e.jsx("span",{className:c["download-label"],children:"Загрузите файл"}),e.jsx("input",{className:c.input,type:"file",multiple:!1,onChange:d})]}),l.length>0&&e.jsxs("div",{className:c.info,children:[e.jsx("ul",{className:c["file-list"],children:e.jsx("li",{children:l[0].name})}),e.jsxs("div",{className:c.btns,children:[e.jsx("button",{className:c["button-reset"],type:"reset",children:"Отменить"}),e.jsx("button",{className:c["button-submit"],type:"submit",children:"Отправить"})]})]})]})})},W="_row_u1dep_1",B={row:W},V=()=>{const[a,l,o,s,r,d]=w(n=>[n.status,n.error,n.messages,n.connect,n.disconnect,n.sendConfig],_),u=D(n=>n.config,_),i=()=>{const n=new TextEncoder().encode(JSON.stringify(u));if(n.length===0){console.log("конфиг не отправлен");return}const g=new TextEncoder().encode("flexibleLogic,"),f=new Uint8Array(g.length+n.length);f.set(g,0),f.set(n,g.length),d(f)};return e.jsxs("div",{children:[e.jsx("h2",{children:"WebSocket"}),e.jsxs("p",{children:["Status: ",a," ",l&&`| Error: ${l}`]}),e.jsx("button",{onClick:()=>s("wss://int-rt.ru:3010"),children:"Подключить"}),e.jsx("br",{}),e.jsx("button",{onClick:r,children:"Отключить"}),e.jsx("div",{style:{height:"300px",overflowY:"auto",border:"1px solid blue",padding:"10px",marginTop:"10px"},children:o.map((n,g)=>e.jsx("p",{children:n},g))}),e.jsx("br",{}),e.jsxs("div",{className:B.row,children:[e.jsx(U,{}),e.jsxs("div",{children:[e.jsx(S,{disabled:!u.scripts.length,onClick:i,text:"загрузить гибкую логику"}),e.jsx("br",{}),!u.scripts.length&&e.jsx("div",{children:"необходимо сформировать гибкую логику"})]})]})]})};export{V as default};
